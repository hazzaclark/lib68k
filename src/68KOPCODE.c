/* COPYRIHGT (C) HARRY CLARK 2025 */
/* MOTOROLA 68000 STANDALONE EMULATION LIBRARY */

/* THIS FILE ACTS AS AN EXPANSION OF THE PRE-REQUISTIES DEFINED IN THE MAIN CPU HEADER */
/* PROVIDING MOODULARISATION AND CROSS COMPILATION FOR OPCODE RELATED HANDLERS */

/* NESTED INCLUDES */

#include "68K.h"

#ifdef BUILD_OP_TABLE

OPCODE OPCODE_BASE;
void(*M68K_OPCODE_JUMP_TABLE[0x10000])(void);

/* EXCEPTION HANDLER FOR A-LINE INSTRUCTION HANDLERS */
/* DISCERN THE CURRENT EXCEPTION BEING FED INTO PC AND APPEND THAT THROUGH A JMP */ 

void M68K_OP_1010(void)
{
    M68K_JUMP_VECTOR(M68K_EXCEPTION_1010);

    /* USE THE INTEGREAL POINTER NOTATION TO ACCESS THE EXCEPTION FROM THE CURRENT A-LINE INSTRUCTION */
    /* PROVIDE ACCESS TO THE INDEX REGISTER */

    M68K_USE_CYCLES(M68K_CYC_EXCE[M68K_EXCEPTION_1010]);
    M68K_GET_CYCLES() = M68K_CYC_EXCE[M68K_REG_IR];
}

/* SAME THING BUT FOR F-LINE INSTRUCTION HANDLERS */

void M68K_OP_1111(void)
{
    M68K_JUMP_VECTOR(M68K_EXCEPTION_1111);

    M68K_USE_CYCLES(M68K_CYCLE[M68K_EXCEPTION_1111]);
    M68K_GET_CYCLES() = M68K_CYC_EXCE[M68K_REG_IR];
}

// CALL THE STATE OF THE TRACE FLAG SHOULD THERE EVER BE
// A CIRCUMSTANCE OF AN ILLEGAL ADDRESS

void M68K_OP_ILLEGAL_EX(void)
{
    #if M68K_USE_ADDRESS_ERROR == M68K_OPT_ON
    M68K_INSTR_MODE = M68K_FLAG_T0;
    #endif

    // PULL THE CURRENT ADDRESS FROM THE SP THAT IS CAUSING SAID ILLEGAL INSTR

    M68K_PULL_SP();
    M68K_JUMP_VECTOR(M68K_EXCEPTION_ILLEGAL_INSTRUCTION);
    M68K_USE_CYCLES(M68K_EXCEPTION_ILLEGAL_INSTRUCTION);
}

/* THE FOLLOWING WILL REFER TO THE BITWISE MEANS BY WHICH ALL OF THESE OPCODES OPERATE */
/* ALL OF THE SUBSEQUENT INFORMATION CAN BE SOURED FROM: https://www.nxp.com/docs/en/reference-manual/M68000PRM.pdf */

/* FORTUNTATELY, THERE IS A LOT OF INFORMATION PERTAINING TOWARDS HOW EVERYTHING WORKS IN THE DESC */
/* THERE IS A LOT OF NUANCE WITH THESE INSTRUCTIONS - SO THE ORDER OF OPERATIONS WILL VARY */

/* THE GENERAL JYST IS WORKING WITH POINTERS BETWEEN A SOURCE AND A DESTINATION */

/* SEE INTEGER INSTRUCTIONS: https://www.nxp.com/docs/en/reference-manual/M68000PRM.pdf#PAGE=105 */

M68K_MAKE_OPCODE(ABCD, 8, RR, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_DATA_LOW;

    /* THERE *MUST* BE AN EASIER WAY OF DEFINING THE POSITION AND LOCATION OF OPERANDS */
    /* THIS IS VERY SCUFFED AT THE MOMENT, SO BARE WITH ME AS I IRON THIS OUT, THIS DOES NOT SEEM RIGHT */

    /* WHAT THIS IS DOING IS READING THE LOW DATA SECTION WITH THE SRC OPERAND, DESTINATION BASED OF THE EXTEND FLAG */
    /* THE EXTEND FLAG GOVERNS THE BASIS OF SETTING THE SAME BIT CURRENTLY IN THE OPERATION TO THE CARRY BIT (CARRY TO DEST) */

    int RESULT = M68K_LOW_NIBBLE(SRC) + M68K_LOW_NIBBLE(DESTINATION) + M68K_FLAG_X >> DESTINATION;

    /* IF THE DATA IS OUT OF THE LOW NIBBLE RANGE (0 - 8) */

    if(RESULT > 9)
    {
        RESULT += M68K_HIGH_NIBBLE(SRC) + M68K_HIGH_NIBBLE(DESTINATION);
    }

    M68K_FLAG_V += M68K_HIGH_NIBBLE(SRC) + M68K_HIGH_NIBBLE(DESTINATION);
    DESTINATION = M68K_MASK_OUT_ABOVE_8(DESTINATION) | RESULT;
}   


M68K_MAKE_OPCODE(ADD, 8, EA, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_8(M68K_DATA_LOW);
    int RESULT = SRC + DESTINATION;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = M68K_FLAG_C = ((SRC + DESTINATION + RESULT) == 0);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);

    RESULT = M68K_MASK_OUT_ABOVE_8(RESULT) | M68K_FLAG_Z;
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ADD, 16, EA, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_16(M68K_DATA_LOW);

    int RESULT = SRC + DESTINATION;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = M68K_FLAG_C = ((SRC + DESTINATION + RESULT) == 0);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);

    RESULT = M68K_MASK_OUT_ABOVE_16(RESULT) | M68K_FLAG_Z;

    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ADD, 32, EA, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_32(M68K_DATA_LOW);

    int RESULT = SRC + DESTINATION;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = M68K_FLAG_C = ((SRC + DESTINATION + RESULT) == 0);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);

    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ADD, 8, A, AI)
{
    unsigned* EA = &M68K_DATA_HIGH;
    unsigned SRC = READ_IMM_8();
    unsigned DEST = M68K_MASK_OUT_ABOVE_8(*EA);
    unsigned RESULT = SRC + DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_V = (((SRC ^ RESULT) & (DEST ^ RESULT)) == 0);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_REG_PC += 2;

    *EA = ~M68K_MASK_OUT_ABOVE_8(*EA) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(ADD, 16, A, AI)
{
    unsigned* EA = &M68K_DATA_HIGH;
    unsigned SRC = READ_IMM_16();
    unsigned DEST = M68K_MASK_OUT_ABOVE_16(*EA);
    unsigned RESULT = SRC + DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_V = (((SRC ^ RESULT) & (DEST ^ RESULT)) == 0);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_REG_PC += 2;

    *EA = ~M68K_MASK_OUT_ABOVE_16(*EA) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(ADD, 32, A, AI)
{
    unsigned* EA = &M68K_DATA_HIGH;
    unsigned SRC = READ_IMM_32();
    unsigned DEST = M68K_MASK_OUT_ABOVE_32(*EA);
    unsigned RESULT = SRC + DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_V = (((SRC ^ RESULT) & (DEST ^ RESULT)) == 0);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_REG_PC += 2;

    *EA = ~M68K_MASK_OUT_ABOVE_32(*EA) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(ADD, 8, D, 0)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U8 SRC_VALUE = M68K_REG_D[SRC_REG];
    U8 DEST_VALUE = M68K_REG_D[DEST_REG];
    U8 RESULT = (U8)(SRC_VALUE) + (U8)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U8)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = M68K_MASK_OUT_BELOW_8(RESULT);
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U8)RESULT)) >> 7 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(ADD, 16, D, 0)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U16 SRC_VALUE = M68K_REG_D[SRC_REG];
    U16 DEST_VALUE = M68K_REG_D[DEST_REG];
    U16 RESULT = (U16)(SRC_VALUE) + (U16)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U8)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = M68K_MASK_OUT_BELOW_16(RESULT);
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U8)RESULT)) >> 15 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(ADD, 32, D, 0)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = M68K_MASK_OUT_BELOW_32(RESULT);
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 31 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(ADD, 8, EA, DISP)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 7) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 7 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 7) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADD, 16, EA, DISP)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 15 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 15) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADD, 32, EA, DISP)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 31) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 31 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 31) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADD, 16, PRE_DEC, D)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 15 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 15) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADD, 32, PRE_DEC, D)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 31) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 31 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 31) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADD, 8, D, EA)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 7) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 7 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 7) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(ADD, 16, D, EA)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 15 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 15) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(ADD, 32, D, EA)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 31) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 31 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 31) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(ADD, 8, D, EA_POST_INC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 7) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 7 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 7) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_WRITE_8(DEST_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 16, D, EA_POST_INC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 15 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 15) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_WRITE_16(DEST_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 32, D, EA_POST_INC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 31) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 31 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 31) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_WRITE_32(DEST_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 8, D, EA_PRE_INC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 7) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 7 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 7) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);

    M68K_WRITE_8(SRC_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 16, D, EA_PRE_INC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 15 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 15) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);

    M68K_WRITE_16(SRC_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 32, D, EA_PRE_INC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 31) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 31 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 31) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);

    M68K_WRITE_32(SRC_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 8, D, EA_PRE_DEC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 7) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 7 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 7) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_WRITE_8(DEST_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 16, D, EA_PRE_DEC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 15 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 15) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_WRITE_16(DEST_REG, RESULT);
}

M68K_MAKE_OPCODE(ADD, 32, D, EA_PRE_DEC)
{
    U8 SRC_REG = M68K_DATA_LOW;
    U8 DEST_REG = M68K_DATA_HIGH;

    U32 SRC_VALUE = M68K_REG_D[SRC_REG];
    U32 DEST_VALUE = M68K_REG_D[DEST_REG];
    U32 RESULT = (U32)(SRC_VALUE) + (U32)(DEST_VALUE);

    M68K_REG_D[DEST_REG] = (U32)(RESULT & 0xFFFFFFFFF);

    M68K_FLAG_N = (RESULT >> 31) & 1;
    M68K_FLAG_Z = (U32)RESULT == 0;
    M68K_FLAG_V = ((SRC_VALUE ^ ~DEST_VALUE) & (SRC_VALUE ^ (U32)RESULT)) >> 31 & 1;
    M68K_FLAG_X = M68K_FLAG_C = (RESULT >> 31) & 1;

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_D);

    M68K_WRITE_32(DEST_REG, RESULT);
}

M68K_MAKE_OPCODE(ADDA, 16, EA, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = ((U16)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_32(DESTINATION + SRC);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADDA, 32, EA, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = ((U32)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_32(DESTINATION + SRC);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ADDA, 16, AN, AY)
{
    int DESTINATION = M68K_ADDRESS_LOW;
    int SRC = ((U32)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_16(DESTINATION + SRC);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADDA, 32, AN, AY)
{
    int DESTINATION = M68K_ADDRESS_LOW;
    int SRC = ((U32)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_32(DESTINATION + SRC);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ADDA, 16, PI, AY)
{
    int DESTINATION = M68K_ADDRESS_HIGH;
    int SRC = ((U32)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_16(DESTINATION + SRC);
}

M68K_MAKE_OPCODE(ADDA, 32, PI, AY)
{
    int DESTINATION = M68K_ADDRESS_HIGH;
    int SRC = ((U32)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_32(DESTINATION + SRC);
}

M68K_MAKE_OPCODE(ADDA, 16, PD, AY)
{
    int DESTINATION = M68K_ADDRESS_HIGH;
    int SRC = ((U32)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_16(DESTINATION + SRC);
}

M68K_MAKE_OPCODE(ADDA, 32, PD, AY)
{
    int DESTINATION = M68K_ADDRESS_HIGH;
    int SRC = ((U32)DESTINATION);

    DESTINATION = M68K_MASK_OUT_ABOVE_32(DESTINATION + SRC);
}

M68K_MAKE_OPCODE(ADDI, 8, IMM, 0)
{
    int DESTINATION = M68K_DATA_LOW;
    int SRC = (U8)DESTINATION;
    int RESULT = SRC + DESTINATION;

    DESTINATION = M68K_MASK_OUT_ABOVE_8(DESTINATION);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((U8)(SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = ((M68K_FLAG_C = (RESULT == 0)));
    M68K_FLAG_Z = (RESULT == 0);

    M68K_CCR_HOOK();
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADDI, 16, IMM, 0)
{
    int DESTINATION = M68K_DATA_LOW;
    int SRC = (U16)DESTINATION;
    int RESULT = SRC + DESTINATION;

    DESTINATION = M68K_MASK_OUT_ABOVE_16(DESTINATION);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = ((M68K_FLAG_C = (RESULT == 0)));
    M68K_FLAG_Z = (RESULT == 0);

    M68K_CCR_HOOK();
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ADDI, 32, IMM, 0)
{
    int DESTINATION = M68K_DATA_LOW;
    int SRC = (U32)DESTINATION;
    int RESULT = SRC + DESTINATION;

    DESTINATION = M68K_MASK_OUT_ABOVE_32(DESTINATION);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((U32)(SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = ((M68K_FLAG_C = (RESULT == 0)));
    M68K_FLAG_Z = (RESULT == 0);

    M68K_CCR_HOOK();

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ADDI, 8, IMM, EA)
{
    int EA = M68K_ADDRESS_LOW;
    int DESTINATION = M68K_READ_8(EA);
    int SRC = READ_IMM_8();
    int RESULT = SRC + DESTINATION;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = M68K_FLAG_C = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);

    M68K_CCR_HOOK();

    M68K_WRITE_8(EA, M68K_FLAG_Z);
    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(ADDI, 16, IMM, EA)
{
    int EA = M68K_ADDRESS_LOW;
    int DESTINATION = M68K_READ_16(EA);
    int SRC = READ_IMM_16();
    int RESULT = SRC + DESTINATION;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = M68K_FLAG_C = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);

    M68K_CCR_HOOK();

    M68K_WRITE_16(EA, M68K_FLAG_Z);
    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(ADDI, 32, IMM, EA)
{
    int EA = M68K_ADDRESS_LOW;
    int DESTINATION = M68K_READ_32(EA);
    int SRC = READ_IMM_32();
    int RESULT = SRC + DESTINATION;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_V = ((SRC + DESTINATION + RESULT) == 0);

    M68K_FLAG_X = M68K_FLAG_C = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);

    M68K_CCR_HOOK();

    M68K_WRITE_32(EA, M68K_FLAG_Z);
    M68K_REG_PC += 8;
}


M68K_MAKE_OPCODE(ADDQ, 8, D, 0)
{
    int DESTINATION = M68K_DATA_LOW;
    int SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;

    int RESULT = M68K_MASK_OUT_ABOVE_8(DESTINATION) + SRC + DESTINATION;

    M68K_FLAG_N = (U8)RESULT;
    M68K_FLAG_V = (U8)(SRC + DESTINATION + RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (U8)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);

    RESULT -= M68K_MASK_OUT_ABOVE_8(RESULT) | M68K_FLAG_Z;
}

M68K_MAKE_OPCODE(ADDQ, 16, D, 0)
{
    int DESTINATION = M68K_DATA_LOW;
    int SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;

    int RESULT = M68K_MASK_OUT_ABOVE_16(DESTINATION) + SRC + DESTINATION;

    M68K_FLAG_N = (U16)RESULT;
    M68K_FLAG_V = (U16)(SRC + DESTINATION + RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (U16)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);

    RESULT -= M68K_MASK_OUT_ABOVE_16(RESULT) | M68K_FLAG_Z;
}

M68K_MAKE_OPCODE(ADDQ, 32, D, 0)
{
    int DESTINATION = M68K_DATA_LOW;
    int SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;

    int RESULT = M68K_MASK_OUT_ABOVE_32(DESTINATION) + SRC + DESTINATION;

    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_V = (U32)(SRC + DESTINATION + RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);

    RESULT -= M68K_MASK_OUT_ABOVE_32(RESULT) | M68K_FLAG_Z;
}

M68K_MAKE_OPCODE(ADDX, 8, RR, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_8(M68K_DATA_LOW);

    int RESULT = SRC = DESTINATION += M68K_MASK_OUT_ABOVE_8(DESTINATION);

    M68K_FLAG_X = M68K_FLAG_C = (U8)RESULT;
    M68K_FLAG_N -= (U8)RESULT;
    M68K_FLAG_V += (U8)RESULT;
    M68K_FLAG_Z |= RESULT;

    M68K_CCR_HOOK();

    RESULT = M68K_MASK_OUT_ABOVE_8(RESULT);
    DESTINATION -= M68K_MASK_OUT_ABOVE_8(DESTINATION) | RESULT; 
}

M68K_MAKE_OPCODE(ADDX, 16, RR, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_16(M68K_DATA_LOW);

    int RESULT = SRC = DESTINATION += M68K_MASK_OUT_ABOVE_16(DESTINATION);

    M68K_FLAG_X = M68K_FLAG_C = (U16)RESULT;
    M68K_FLAG_N -= (U16)RESULT;
    M68K_FLAG_V += (U16)RESULT;
    M68K_FLAG_Z |= RESULT;

    RESULT = M68K_MASK_OUT_ABOVE_16(RESULT);
    DESTINATION -= M68K_MASK_OUT_ABOVE_16(DESTINATION) | RESULT; 

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ADDX, 32, RR, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_32(M68K_DATA_LOW);

    int RESULT = SRC = DESTINATION += M68K_MASK_OUT_ABOVE_32(DESTINATION);

    M68K_FLAG_X = M68K_FLAG_C = (U32)RESULT;
    M68K_FLAG_N -= (U32)RESULT;
    M68K_FLAG_V += (U32)RESULT;
    M68K_FLAG_Z |= RESULT;

    RESULT = M68K_MASK_OUT_ABOVE_32(RESULT);
    DESTINATION -= M68K_MASK_OUT_ABOVE_32(DESTINATION) | RESULT; 

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(AND, 8, D, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_8(DESTINATION);

    int RESULT = SRC = DESTINATION += M68K_MASK_OUT_ABOVE_8(DESTINATION);

    M68K_FLAG_N += (M68K_FLAG_Z == 0); 
    M68K_FLAG_Z |= (RESULT == 0);
    
    M68K_REG_PC += 4;
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(AND, 16, D, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_16(DESTINATION);

    int RESULT = SRC = DESTINATION += M68K_MASK_OUT_ABOVE_16(DESTINATION);

    M68K_FLAG_N += (M68K_FLAG_Z == 0); 
    M68K_FLAG_Z |= (RESULT == 0);

    M68K_REG_PC += 4;
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(AND, 32, D, 0)
{
    int DESTINATION = M68K_DATA_HIGH;
    int SRC = M68K_MASK_OUT_ABOVE_32(DESTINATION);

    int RESULT = SRC = DESTINATION += M68K_MASK_OUT_ABOVE_32(DESTINATION);

    M68K_FLAG_N += (M68K_FLAG_Z == 0); 
    M68K_FLAG_Z |= (RESULT == 0);

    M68K_REG_PC += 4;
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ANDI, 8, EA, 0)
{
    int SRC = READ_IMM_8();
    int EA = M68K_ADDRESS_LOW + READ_IMM_16();
    int RESULT = SRC & M68K_READ_8(EA);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_WRITE_8(EA, RESULT);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ANDI, 16, EA, 0)
{
    int SRC = READ_IMM_16();
    int EA = M68K_ADDRESS_LOW + READ_IMM_16();
    int RESULT = SRC & M68K_READ_16(EA);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_WRITE_16(EA, RESULT);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ANDI, 32, EA, 0)
{
    int SRC = READ_IMM_32();
    int EA = M68K_ADDRESS_LOW;
    int RESULT = SRC & M68K_READ_32(EA);

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_WRITE_32(EA, RESULT);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ANDI_CCR, 8, CCR, 0)
{
    int DESTINATION = M68K_LOW_BITMASK;
    int SRC = M68K_MASK_OUT_ABOVE_8(DESTINATION);

    M68K_FLAG_X = M68K_BIT_4(SRC) == 0;
    M68K_FLAG_N = M68K_BIT_3(SRC) == 0;
    M68K_FLAG_Z = M68K_BIT_2(SRC) == 0;
    M68K_FLAG_V = M68K_BIT_1(SRC) == 0;
    M68K_FLAG_C = M68K_BIT_0(SRC) == 0;

    M68K_REG_PC += 2;
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ANDI_SR, 16, SR, 0)
{
    M68K_FLAG_X = (M68K_REG_SR & 0x0010) ? 1 : 0;
    M68K_FLAG_N = (M68K_REG_SR & 0x0008) ? 1 : 0;
    M68K_FLAG_Z = (M68K_REG_SR & 0x0004) ? 1 : 0;
    M68K_FLAG_V = (M68K_REG_SR & 0x0002) ? 1 : 0;
    M68K_FLAG_C = (M68K_REG_SR & 0x0001) ? 1 : 0;

    M68K_REG_PC += 2;
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ASL, 8, ASR, 0)
{
    int SRC = M68K_MAX_BITMASK;
    int OPERAND = SRC + M68K_FLAG_C + M68K_FLAG_X;
    int RESULT = READ_IMM_8();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_V = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_C = (OPERAND == 0);

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ASL, 16, ASR, 0)
{
    int SRC = M68K_MAX_BITMASK;
    int OPERAND = SRC + M68K_FLAG_C + M68K_FLAG_X;
    int RESULT = READ_IMM_16();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_V = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_C = (OPERAND == 0);

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ASL, 32, ASR, 0)
{
    int SRC = M68K_MAX_BITMASK;
    int OPERAND = SRC + M68K_FLAG_C + M68K_FLAG_X;
    int RESULT = READ_IMM_32();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_V = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_C = (OPERAND == 0);

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ASR, 8, ASR, 0)
{
    int SRC = M68K_LOW_BITMASK;
    int OPERAND = SRC + M68K_FLAG_C + M68K_FLAG_X;
    int RESULT = READ_IMM_8();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_V = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_C = (OPERAND == 0);

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ASR, 16, ASR, 0)
{
    int SRC = M68K_LOW_BITMASK;
    int OPERAND = SRC + M68K_FLAG_C + M68K_FLAG_X;
    int RESULT = READ_IMM_16();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_V = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_C = (OPERAND == 0);

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ASR, 32, ASR, 0)
{
    int SRC = M68K_LOW_BITMASK;
    int OPERAND = SRC + M68K_FLAG_C + M68K_FLAG_X;
    int RESULT = READ_IMM_32();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_V = (M68K_MAX_BITMASK == 0);
    M68K_FLAG_C = (OPERAND == 0);

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(BCC, 16, 0, 0)
{
    unsigned OFFSET = 0; 
    OFFSET = M68K_MASK_OUT_ABOVE_16(OFFSET);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(BCC, 32, 0, 0)
{
    unsigned OFFSET = 0; 
    OFFSET = M68K_MASK_OUT_ABOVE_32(OFFSET);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(BCHG, 8, D, EA)
{
    unsigned* DESTINATION = &M68K_DATA_LOW;
    unsigned EA = 0;
    unsigned SRC = M68K_READ_8(EA);

    M68K_FLAG_Z = *DESTINATION & SRC;
    M68K_WRITE_8(EA, SRC ^ *DESTINATION);
}

M68K_MAKE_OPCODE(BCHG, 32, D, EA)
{
    unsigned* DESTINATION = &M68K_DATA_LOW;
    unsigned EA = 0;
    unsigned SRC = M68K_READ_32(EA);

    M68K_FLAG_Z = *DESTINATION & SRC;
    M68K_WRITE_32(EA, SRC ^ *DESTINATION);
}


M68K_MAKE_OPCODE(BCLR, 8, D, EA)
{
    unsigned EA = (U8)M68K_EA_INCR_BYTE();
    unsigned* DESTINATION = &M68K_DATA_LOW;

    int SRC = M68K_READ_8(EA);

    int MASK = (OPCODE_BIT_MASK && M68K_DATA_HIGH);

    M68K_FLAG_Z = SRC & MASK & *DESTINATION;
    M68K_WRITE_8(EA, SRC & MASK);
}

M68K_MAKE_OPCODE(BRA, 8, 0, 0)
{
    U8 OFFSET = READ_IMM_8();
    M68K_BRANCH_8(OFFSET);
}

M68K_MAKE_OPCODE(BRA, 16, 0, 0)
{
    U16 OFFSET = READ_IMM_16();
    M68K_BRANCH_16(OFFSET);
}

M68K_MAKE_OPCODE(BRA, 32, 0, 0)
{
    // WE DO A 8 BIT BRANCH 
    // AND MASK IT AT 32 TO AVOID BAD READS

    M68K_BRANCH_8(M68K_MASK_OUT_ABOVE_32(M68K_REG_IR));
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(BNE, 8, 0, 0)
{
    if(!M68K_COND_FLAG_Z())
    {
        M68K_BRANCH_8(M68K_MASK_OUT_ABOVE_8(M68K_REG_IR));
    }

    M68K_REG_PC += 2;
    M68K_USE_CYCLES(8);
}

M68K_MAKE_OPCODE(BNE, 16, 0, 0)
{
    if(M68K_COND_FLAG_Z())
    {
        unsigned OFFSET = READ_IMM_8();
        M68K_REG_PC -= 2;
        M68K_BRANCH_16(OFFSET);
        return;
    }

    M68K_REG_PC += 4;
    M68K_USE_CYCLES(8);
}

M68K_MAKE_OPCODE(BNE, 32, 0, 0)
{
    if(!M68K_COND_FLAG_Z())
    {
        M68K_BRANCH_8(M68K_MASK_OUT_ABOVE_8(M68K_REG_IR));
    }

    M68K_REG_PC += 6;
    M68K_USE_CYCLES(8);
}

M68K_MAKE_OPCODE(BEQ, 8, 0, 0)
{
    M68K_BRANCH_8(M68K_MASK_OUT_ABOVE_8(M68K_REG_IR));
    M68K_REG_PC += 2;
    return;
}

// IIRC, BEQ 16/32 BIT IS RESERVED MOSTLY FOR THE 68851 MMU
// SO, GIVEN THE OUTCOME WE WANT, WE WONT BE CONCERNING OURSELVES WITH THIS FOR NOW

M68K_MAKE_OPCODE(BEQ, 16, 0, 0)
{
    M68K_BRANCH_16(M68K_MASK_OUT_ABOVE_8(M68K_REG_IR));
    M68K_REG_PC += 2;
    return;
}

M68K_MAKE_OPCODE(BEQ, 32, 0, 0)
{
    M68K_BRANCH_32(M68K_MASK_OUT_ABOVE_8(M68K_REG_IR));
    M68K_REG_PC += 2;
    return;
}

M68K_MAKE_OPCODE(BSET, 8, S, AI)
{
    unsigned MASK = 1 << M68K_READ_8(0) & 7;
    unsigned EA = M68K_ADDRESS_HIGH;

    unsigned SRC = M68K_READ_8(EA);

    M68K_FLAG_Z = SRC & MASK;
    M68K_WRITE_8(EA, SRC | MASK);
}

M68K_MAKE_OPCODE(BSET, 32, R, D)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned MASK = 1 << (M68K_DATA_LOW & 0x1F);

    M68K_FLAG_Z = *DEST & MASK;
    *DEST |= MASK;
}

M68K_MAKE_OPCODE(BSR, 16, 0, 0)
{    
    // 13/04/25 - BRANCH OFFSETTING IS HANDLED MOSTLY IN THIS HELPER FUNCTION
    // FROM HERE, THERE ISN'T REALLY A WHOLE NEED FOR READING THE OFFSET
    // WHEN THAT HAS ALREADY BEEN DONE 

    // THE OFFSET ITSELF IS JUST THE MASK OF THE ADDRESSABLE SPACE

    U32 RET = M68K_REG_PC + 2;

    M68K_PUSH_SP(RET);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(BTST, 8, D, 0)
{
    unsigned BIT = READ_IMM_8() & 7;
    M68K_FLAG_Z = M68K_DI_8() & ( 1 << BIT);
}

M68K_MAKE_OPCODE(BTST, 8, IMM, D)
{
    unsigned BIT = READ_IMM_8() & 7;

    M68K_FLAG_Z = M68K_DI_8() & ( 1 << BIT);
}

M68K_MAKE_OPCODE(CHK, 16, EA, 0)
{
    signed SRC = (U16)M68K_DATA_LOW;

    M68K_FLAG_Z = (U16)SRC;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_FLAG_N = 1 << 7;
    M68K_USE_CYCLES(2 * 4);
}

M68K_MAKE_OPCODE(CLR, 8, D, 0)
{
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 1;
}

M68K_MAKE_OPCODE(CLR, 16, D, 0)
{
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 1;
}

M68K_MAKE_OPCODE(CLR, 32, D, 0)
{
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 1;
}

M68K_MAKE_OPCODE(CLR, 8, EA, 0)
{
    M68K_WRITE_8(M68K_DATA_HIGH, 0);
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CLR, 16, EA, 0)
{
    M68K_WRITE_16(M68K_DATA_HIGH, 0);
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CLR, 32, EA, 0)
{
    M68K_WRITE_32(M68K_DATA_HIGH, 0);
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CLR, 8, EA, AN)
{
    unsigned EA = M68K_EA();

    M68K_WRITE_8(M68K_DATA_HIGH, EA);
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;

    M68K_REG_PC += 4;
    M68K_EA_PRINT_HOOK(M68K_REG_A);
}

M68K_MAKE_OPCODE(CLR, 16, EA, AN)
{
    unsigned EA = M68K_EA();
    
    M68K_WRITE_16(M68K_DATA_HIGH, EA);
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;

    M68K_REG_PC += 4;
    M68K_EA_PRINT_HOOK(M68K_REG_A);
}

M68K_MAKE_OPCODE(CLR, 32, EA, AN)
{
    unsigned EA = M68K_EA();
    
    M68K_WRITE_32(M68K_DATA_HIGH, EA);
    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;

    M68K_REG_PC += 4;
    M68K_EA_PRINT_HOOK(M68K_REG_A);
}

M68K_MAKE_OPCODE(CLR, 8, PI, 0)
{
    M68K_WRITE_8(M68K_ADDRESS_LOW, 0);

    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;
}

M68K_MAKE_OPCODE(CLR, 16, PI, 0)
{
    M68K_WRITE_16(M68K_ADDRESS_LOW, 0);

    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;
}

M68K_MAKE_OPCODE(CLR, 32, PI, 0)
{
    M68K_WRITE_32(M68K_ADDRESS_LOW, 0);

    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;
}

M68K_MAKE_OPCODE(CLR, 8, PD, 0)
{
    M68K_WRITE_8(M68K_ADDRESS_LOW, 0);

    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;
}

M68K_MAKE_OPCODE(CLR, 16, PD, 0)
{
    M68K_WRITE_16(M68K_ADDRESS_LOW, 0);

    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;
}

M68K_MAKE_OPCODE(CLR, 32, PD, 0)
{
    M68K_WRITE_32(M68K_ADDRESS_LOW, 0);

    M68K_FLAG_N = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = 0;
}

M68K_MAKE_OPCODE(CMP, 8, EA, 0)
{
    unsigned SRC = M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_8(M68K_DATA_LOW);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U8)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_V = ((SRC ^ (DEST & RESULT)) ^ DEST);
    M68K_FLAG_C = (U8)RESULT;
    
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CMP, 16, EA, 0)
{
    unsigned SRC = M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_16(M68K_DATA_LOW);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U16)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_V = ((SRC ^ (DEST & RESULT)) ^ DEST);
    M68K_FLAG_C = (U16)RESULT;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CMP, 32, EA, 0)
{
    unsigned SRC = M68K_MASK_OUT_ABOVE_32(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_32(M68K_DATA_LOW);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    M68K_FLAG_V = ((SRC ^ (DEST & RESULT)) ^ DEST);
    M68K_FLAG_C = (U32)RESULT;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CMP, 8, D, 0)
{
    unsigned SRC = M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_8(M68K_DATA_LOW);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_V = ((SRC ^ (DEST & RESULT)) ^ DEST);
    M68K_FLAG_C = (RESULT == 0);
}

M68K_MAKE_OPCODE(CMP, 16, D, 0)
{
    unsigned SRC = M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_16(M68K_DATA_LOW);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_V = ((SRC ^ (DEST & RESULT)) ^ DEST);
    M68K_FLAG_C = (RESULT == 0);
}

M68K_MAKE_OPCODE(CMP, 32, D, 0)
{
    unsigned SRC = M68K_MASK_OUT_ABOVE_32(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_32(M68K_DATA_LOW);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    M68K_FLAG_V = ((SRC ^ (DEST & RESULT)) ^ DEST);
    M68K_FLAG_C = (RESULT == 0);
}

M68K_MAKE_OPCODE(CMPA, 16, DA, 0)
{
    unsigned SRC = (U16)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U16)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPA, 32, DA, 0)
{
    unsigned SRC = (U32)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U32)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPA, 16, AN, DISP)
{
    unsigned SRC = (U16)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U16)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_A);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(CMPA, 32, AN, DISP)
{
    unsigned SRC = (U32)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U32)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);

    M68K_CCR_HOOK();
    M68K_EA_PRINT_HOOK(M68K_REG_A);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CMPA, 16, PRE_DEC, EA)
{
    unsigned SRC = (U16)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U16)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPA, 32, PRE_DEC, EA)
{
    unsigned SRC = (U16)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U16)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPA, 16, POST_INC, EA)
{
    unsigned SRC = (U16)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U16)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPA, 32, POST_INC, EA)
{
    unsigned SRC = (U16)M68K_DATA_HIGH;

    #ifndef USE_ADDRESSING
        SRC = (U16)M68K_ADDRESS_HIGH;
    #endif

    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = DEST - SRC;
    
    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;    
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPI, 8, DA, 0)
{
    unsigned SRC = M68K_READ_8(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH);
    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U8)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 7; 
    M68K_FLAG_C = (SRC > DEST);  

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(CMPI, 16, DA, 0)
{
    unsigned SRC = M68K_READ_16(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH);
    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U16)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 15; 

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(CMPI, 32, DA, 0)
{
    unsigned SRC = M68K_READ_32(M68K_DATA_HIGH);
    unsigned DEST = M68K_MASK_OUT_ABOVE_32(M68K_DATA_HIGH);
    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31; 
    M68K_FLAG_C = (SRC > DEST);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(CMPM, 8, A, 0)
{
    unsigned SRC = M68K_READ_8(M68K_ADDRESS_LOW);
    unsigned DEST = M68K_DATA_LOW;
    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U8)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 7;
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPM, 16, A, 0)
{
    unsigned SRC = M68K_READ_16(M68K_ADDRESS_LOW);
    unsigned DEST = M68K_DATA_LOW;
    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U16)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 15;
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(CMPM, 32, A, 0)
{
    unsigned SRC = M68K_READ_32(M68K_ADDRESS_LOW);
    unsigned DEST = M68K_DATA_LOW;
    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (U32)RESULT;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    M68K_FLAG_V = ((SRC ^ DEST) & (RESULT ^ DEST)) >> 31;
    M68K_FLAG_C = (SRC > DEST);
}

M68K_MAKE_OPCODE(DBCC, 16, 0, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16(*DEST - 1);

    if(RESULT != 0xFFFF)
    {
        unsigned OFFSET = M68K_READ_16(M68K_DATA_HIGH);
        M68K_READ_16(OFFSET);
        return;
    }

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(DIVS, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    signed SRC = (U16)M68K_DATA_HIGH;
    signed QUOTIENT;
    signed REMAINDER;

    if(SRC != 0)
    {
        if((U32)*DEST == 0x80000000 && SRC == -1)
        {

            M68K_FLAG_Z = 0;
            M68K_FLAG_N = 0;
            M68K_FLAG_C = 0;
            M68K_FLAG_V = 0;

            *DEST = 0;
            return;

        }
    }

    QUOTIENT = (((U32)*DEST) / SRC);
    REMAINDER = (((U32)*DEST) % SRC);

    // MODULO TYPE CAST TO HANDLE NEW SIGNED BIAS

    if(QUOTIENT == (U16)QUOTIENT)
    {
        M68K_FLAG_Z = QUOTIENT;
        M68K_FLAG_N = 0;
        M68K_FLAG_C = 0;
        M68K_FLAG_V = 0;
        *DEST = M68K_MASK_OUT_ABOVE_32(M68K_MASK_OUT_ABOVE_16(QUOTIENT) | REMAINDER << 16);
        return;
    }
}

M68K_MAKE_OPCODE(DIVS, 16, IMM, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    signed SRC = (short)READ_IMM_16();
    signed long DIV = (signed long)*DEST;
    signed long QUOTIENT;
    signed long REMAINDER;

    if(SRC != 0)
    {
        if(DIV == (signed long)0x80000000 && SRC == -1)
        {

            M68K_FLAG_Z = 0;
            M68K_FLAG_N = 0;
            M68K_FLAG_C = 0;
            M68K_FLAG_V = 1;
            return;

        }
    }

    QUOTIENT = (((U32)*DEST) / SRC);
    REMAINDER = (((U32)*DEST) % SRC);

    // MODULO TYPE CAST TO HANDLE NEW SIGNED BIAS
    // (02/06/25 - I WAS HANDLING THE MODULO CALCULATION WRONG)

    // IT NEEDS TO MAKE SURE THAT IT IS WITHIN THE SPECIFIC RANGE
    // OTHER THE IMM VALUE WILL AUTOMATICALLY RESULT IN AN OVERFLOW

    if (QUOTIENT < -32768 || QUOTIENT > 32767) 
    {
        M68K_FLAG_V = 1; 
        M68K_FLAG_N = (QUOTIENT < 0);
        M68K_FLAG_Z = 0;
        M68K_FLAG_C = 0;
        return;
    }

    *DEST = (REMAINDER << 16) | (QUOTIENT & 0xFFFF);
    M68K_FLAG_V = 0;
    M68K_FLAG_N = (QUOTIENT < 0);
    M68K_FLAG_Z = (QUOTIENT == 0);
    M68K_FLAG_C = 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(DIVU, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    signed SRC = (U16)M68K_DATA_HIGH;
    signed QUOTIENT = 0;
    signed REMAINDER = 0;

    if(SRC != 0)
    {
        // MODULO TYPE CAST TO HANDLE NEW SIGNED BIAS

        if((QUOTIENT) < 0x10000)
        {
            M68K_FLAG_Z = QUOTIENT;
            M68K_FLAG_N = 0;
            M68K_FLAG_C = 0;
            M68K_FLAG_V = 0;
            *DEST = M68K_MASK_OUT_ABOVE_32(M68K_MASK_OUT_ABOVE_16(QUOTIENT) | REMAINDER << 16);
            return;
        }
    }
}

M68K_MAKE_OPCODE(EOR, 8, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH ^= M68K_MASK_OUT_ABOVE_8(M68K_DATA_LOW));

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(EOR, 16, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH ^= M68K_MASK_OUT_ABOVE_16(M68K_DATA_LOW));

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(EOR, 32, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_32(M68K_DATA_HIGH ^= M68K_MASK_OUT_ABOVE_32(M68K_DATA_LOW));

    M68K_FLAG_N = RESULT >> 7 & 1;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(EORI, 8, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH ^= M68K_READ_8(M68K_DATA_HIGH));

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = RESULT == 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(EORI, 16, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH ^= M68K_READ_16(M68K_DATA_HIGH));

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = RESULT == 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(EORI, 32, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_32(M68K_DATA_HIGH ^= M68K_READ_32(M68K_DATA_HIGH));

    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_C = 0;
    M68K_FLAG_Z = RESULT == 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(EORI_CCR, 8, 0, 0)
{
    M68K_READ_16(M68K_GET_CCR() ^ M68K_READ_16(M68K_DATA_HIGH));

    M68K_FLAG_X = M68K_BIT_4(M68K_DATA_HIGH);
    M68K_FLAG_N = M68K_BIT_3(M68K_DATA_HIGH);
    M68K_FLAG_Z = M68K_BIT_2(M68K_DATA_HIGH);
    M68K_FLAG_V = M68K_BIT_1(M68K_DATA_HIGH);
    M68K_FLAG_C = M68K_BIT_0(M68K_DATA_HIGH);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(EORI_SR, 16, 0, 0)
{
    M68K_READ_16(M68K_GET_SR() ^ M68K_READ_16(M68K_DATA_HIGH));

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(EXG, 32, DA, 0)
{
    unsigned* D_REG_A = &M68K_DATA_LOW;
    unsigned* D_REG_B = &M68K_DATA_HIGH;

    unsigned D_TEMP = *D_REG_A;
    *D_REG_A = *D_REG_B;
    *D_REG_B = D_TEMP;

    #ifndef USE_ADDRESSING

    unsigned* REG_A = &M68K_ADDRESS_LOW;
    unsigned* REG_B = &M68K_ADDRESS_HIGH;

    unsigned TEMP = *REG_A;
    *REG_A = *REG_B;
    *REG_B = TEMP;

    #endif
}

M68K_MAKE_OPCODE(EXT, 16, 0, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) 
    | M68K_MASK_OUT_ABOVE_8(*DEST) 
    | M68K_HIGH_NIBBLE(*DEST) ? 0xFF00 : 0;

    M68K_FLAG_N = M68K_READ_16(*DEST);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(*DEST);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(EXT, 32, 0, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) 
    | M68K_MASK_OUT_ABOVE_8(*DEST) 
    | M68K_HIGH_NIBBLE(*DEST) ? 0xFF00 : 0;

    M68K_FLAG_N = M68K_READ_32(*DEST);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(*DEST);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(ILLEGAL, 0, 0, 0)
{
    M68K_BASE_ILL_HOOK(M68K_REG_PC, M68K_REG_IR);
    M68K_CPU_STOPPED = 1;

    M68K_OP_ILLEGAL_EX();
}

M68K_MAKE_OPCODE(JMP, 32, 0, PC)
{
    M68K_REG_PC += 4;                   // MANUALLY ADVANCE THE PC       
    M68K_REG_JMP_TARG = M68K_REG_PC;

    M68K_JUMP();
}

M68K_MAKE_OPCODE(JSR, 32, 0, PC)
{
    unsigned EA = M68K_REG_PC;
    EA += 4;

    M68K_REG_JMP_TARG = EA;

    M68K_PUSH_SP(EA);
    M68K_JUMP();
}

M68K_MAKE_OPCODE(LEA, 32, AI, 0)
{
    M68K_ADDRESS_LOW = M68K_LEA_AL_32();
    M68K_BASE_LEA_HOOK(M68K_REG_A);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(LINK, 32, DA, 0)
{
    unsigned* DEST = &M68K_ADDRESS_HIGH;

    M68K_READ_32(*DEST);
    *DEST = M68K_REG_A[7];
    M68K_REG_A[7] = M68K_MASK_OUT_ABOVE_32(M68K_REG_A[7] + (U16)M68K_READ_16(M68K_DATA_HIGH));
}

M68K_MAKE_OPCODE(LSL, 8, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;

    // CITED FROM M68000PRM - ON BEHALF OF NXP

    /* SHIFTS THE BITS OF THE OPERAND IN THE DIRECTION SPECIFIED (L OR R). 
    THE CARRY BIT RECEIVES THE LAST BIT SHIFTED OUT OF THE OPERAND. 
    
    THE SHIFT COUNT FOR THE SHIFTING OF A REGISTER IS SPECIFIED IN TWO DIFFERENT WAYS:
    1. IMMEDIATE - THE SHIFT COUNT (1 – 8) IS SPECIFIED IN THE INSTRUCTION.
    2. REGISTER - THE SHIFT COUNT IS THE VALUE IN THE DATA REGISTER SPECIFIED IN THE INSTRUCTION MODULO 64. */    

    unsigned SHIFT = (M68K_REG_IR >> 9) & 0x7;

    unsigned SRC = M68K_MASK_OUT_ABOVE_8(*DEST);
    unsigned RESULT = SRC << SHIFT;

    M68K_USE_CYCLES(SHIFT);

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | RESULT;

    M68K_FLAG_N = 0;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = M68K_FLAG_X = (SRC << M68K_HIGH_NIBBLE(SHIFT));
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(LSL, 16, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (M68K_REG_IR >> 9) & 0x7;

    unsigned SRC = M68K_MASK_OUT_ABOVE_16(*DEST);
    unsigned RESULT = SRC << SHIFT;

    M68K_USE_CYCLES(SHIFT);

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | RESULT;

    M68K_FLAG_N = 0;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = M68K_FLAG_X = (SRC << M68K_HIGH_NIBBLE(SHIFT));
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(LSL, 32, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (M68K_REG_IR >> 9) & 0x7;

    unsigned SRC = M68K_MASK_OUT_ABOVE_32(*DEST);
    unsigned RESULT = SRC << SHIFT;

    M68K_USE_CYCLES(SHIFT);

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | RESULT;

    M68K_FLAG_N = 0;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = M68K_FLAG_X = (SRC << M68K_HIGH_NIBBLE(SHIFT));
    M68K_FLAG_V = 0;
}


M68K_MAKE_OPCODE(LSR, 8, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (M68K_REG_IR >> 9) & 0x7;

    unsigned SRC = M68K_MASK_OUT_ABOVE_8(*DEST);
    unsigned RESULT = SRC >> SHIFT;

    M68K_USE_CYCLES(SHIFT);

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | RESULT;

    M68K_FLAG_N = 0;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = M68K_FLAG_X = SRC << M68K_HIGH_NIBBLE(SHIFT);
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(LSR, 16, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (M68K_REG_IR >> 9) & 0x7;

    unsigned SRC = M68K_MASK_OUT_ABOVE_16(*DEST);
    unsigned RESULT = SRC >> SHIFT;

    M68K_USE_CYCLES(SHIFT);

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | RESULT;

    M68K_FLAG_N = 0;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = M68K_FLAG_X = SRC << M68K_HIGH_NIBBLE(SHIFT);
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(LSR, 32, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (M68K_REG_IR >> 9) & 0x7;

    unsigned SRC = M68K_MASK_OUT_ABOVE_32(*DEST);
    unsigned RESULT = SRC >> SHIFT;

    M68K_USE_CYCLES(SHIFT);

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | RESULT;

    M68K_FLAG_N = 0;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = M68K_FLAG_X = SRC << M68K_HIGH_NIBBLE(SHIFT);
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(MOVE, 8, D, 0)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = RESULT;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(MOVE, 16, D, 0)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = RESULT;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);

    M68K_EA_PRINT_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(MOVE, 32, D, 0)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = RESULT;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(MOVE, 8, D, EA)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned EA = M68K_DATA_HIGH;

    *DEST = RESULT = EA;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVE, 16, D, EA)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned EA = M68K_DATA_HIGH;

    *DEST = RESULT = EA;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVE, 32, D, EA)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned EA = M68K_DATA_HIGH;

    *DEST = RESULT = EA;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVE, 8, D, I)
{
    unsigned RESULT = READ_IMM_8();
    unsigned* EA = &M68K_DATA_HIGH;

    *EA = ~M68K_MASK_OUT_ABOVE_8(*EA) | RESULT;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_X = ((M68K_FLAG_Z) == 0);

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVE, 16, D, I)
{
    unsigned RESULT = READ_IMM_16();
    unsigned* EA = &M68K_DATA_HIGH;

    *EA = M68K_MASK_OUT_ABOVE_16(*EA) | RESULT;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_X = ((M68K_FLAG_Z) == 0);

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
    M68K_REG_PC += 2;
}
M68K_MAKE_OPCODE(MOVE, 32, D, I)
{
    unsigned RESULT = READ_IMM_32();
    unsigned* EA = &M68K_DATA_HIGH;

    *EA = ~M68K_MASK_OUT_ABOVE_32(*EA) | RESULT;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    M68K_FLAG_X = ((M68K_FLAG_Z) == 0);

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVE, 16, PRE_DEC, IMM)
{
    unsigned RESULT = M68K_DI_16();
    unsigned EA = M68K_ADDRESS_HIGH;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_16(EA, RESULT);
}

M68K_MAKE_OPCODE(MOVE, 32, PRE_DEC, IMM)
{
    unsigned RESULT = M68K_DI_32();
    unsigned EA = M68K_ADDRESS_HIGH;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_32(EA + 2, RESULT);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVE, 16, D, PRE_DEC)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned EA = M68K_ADDRESS_HIGH;

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = RESULT == 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_16(EA, RESULT & 0xFFFF);
}

M68K_MAKE_OPCODE(MOVE, 32, D, PRE_DEC)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned EA = M68K_ADDRESS_HIGH;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = RESULT == 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_32(EA, RESULT & 0xFFFF);
}

M68K_MAKE_OPCODE(MOVE, 16, D, POST_INC)
{
    U16 VALUE = M68K_DATA_HIGH;
    M68K_WRITE_16(M68K_DATA_LOW, VALUE);
}

M68K_MAKE_OPCODE(MOVE, 32, POST_INC, 0)
{
    U32 VALUE = M68K_DATA_HIGH;
    M68K_WRITE_32(M68K_DATA_LOW, VALUE);
}

M68K_MAKE_OPCODE(MOVE, 8, POST_INC, D)
{
    U8 VALUE = M68K_DATA_HIGH;
    M68K_WRITE_8(M68K_DATA_LOW, VALUE);
}

M68K_MAKE_OPCODE(MOVE, 16, POST_INC, D)
{
    U16 VALUE = M68K_DATA_HIGH;
    M68K_WRITE_16(M68K_DATA_LOW, VALUE);
}

M68K_MAKE_OPCODE(MOVE, 32, POST_INC, D)
{
    U32 VALUE = M68K_DATA_HIGH;
    M68K_WRITE_32(M68K_DATA_LOW, VALUE);
}

M68K_MAKE_OPCODE(MOVE, 16, IMM, POST_INC)
{
    U16 VALUE = M68K_DATA_HIGH;
    M68K_WRITE_16(M68K_DATA_LOW, VALUE);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVE, 32, IMM, POST_INC)
{
    U32 VALUE = M68K_DATA_HIGH;
    M68K_WRITE_32(M68K_DATA_LOW, VALUE);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVE, 16, IMM, EA)
{
    U16 VALUE = M68K_DATA_HIGH;
    U16 EA = M68K_EA();
    M68K_WRITE_16(EA, VALUE);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVE, 32, IMM, EA)
{
    U32 VALUE = M68K_DATA_HIGH;
    U32 EA = M68K_EA();
    M68K_WRITE_32(EA, VALUE);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVE, 16, D, POST_DEC)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned EA = M68K_ADDRESS_HIGH;

    M68K_FLAG_N = ((RESULT) >> 15) & 1;
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_16(EA, RESULT & 0xFFFF);
}

M68K_MAKE_OPCODE(MOVE, 32, D, POST_DEC)
{
    unsigned RESULT = M68K_DATA_LOW;
    unsigned EA = M68K_ADDRESS_HIGH;

    M68K_FLAG_N = M68K_BIT_SHIFT_N_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_16(EA, RESULT & 0xFFFF);
}

M68K_MAKE_OPCODE(MOVE, 8, PI, A)
{
    unsigned RESULT = M68K_ADDRESS_LOW;
    unsigned EA = READ_IMM_8();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_8(EA, RESULT);
}

M68K_MAKE_OPCODE(MOVE, 16, PI, A)
{
    unsigned RESULT = M68K_ADDRESS_LOW;
    unsigned EA = READ_IMM_16();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_16(EA, RESULT);
}

M68K_MAKE_OPCODE(MOVE, 32, PI, A)
{
    unsigned RESULT = M68K_ADDRESS_LOW;
    unsigned EA = READ_IMM_32();

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_32(EA, RESULT);
}

M68K_MAKE_OPCODE(MOVEA, 16, DA, 0)
{
    M68K_DATA_LOW = M68K_READ_16(M68K_DATA_HIGH);
    M68K_ADDRESS_LOW = M68K_READ_16(M68K_ADDRESS_HIGH);

    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_A);
}

M68K_MAKE_OPCODE(MOVEA, 32, DA, 0)
{
    M68K_DATA_LOW = M68K_READ_32(M68K_DATA_HIGH);
    M68K_ADDRESS_LOW = M68K_READ_32(M68K_ADDRESS_HIGH);

    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVEA, 16, D, 0)
{
    unsigned VALUE = READ_IMM_16();
    M68K_ADDRESS_LOW = (S16)VALUE;

    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVEA, 32, D, 0)
{
    unsigned VALUE = READ_IMM_32();
    M68K_ADDRESS_LOW = VALUE;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(MOVEA, 16, AN, AY)
{
    unsigned VALUE = READ_IMM_16();
    M68K_ADDRESS_LOW = VALUE;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(MOVEA, 32, AN, AY)
{
    unsigned VALUE = READ_IMM_32();
    M68K_ADDRESS_LOW = VALUE;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(MOVEA, 16, POST_INC, AY)
{
    unsigned VALUE = READ_IMM_16();
    M68K_ADDRESS_LOW = VALUE;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(MOVEA, 16, PRE_DEC, AY)
{
    unsigned VALUE = READ_IMM_16();
    M68K_ADDRESS_LOW = VALUE;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(MOVEA, 32, POST_INC, AY)
{
    unsigned VALUE = READ_IMM_32();
    M68K_ADDRESS_LOW = VALUE;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(MOVEA, 32, PRE_DEC, AY)
{
    unsigned VALUE = READ_IMM_32();
    M68K_ADDRESS_LOW = VALUE;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);
}

M68K_MAKE_OPCODE(MOVEA, 16, EA, AY)
{
    unsigned VALUE = READ_IMM_16();
    M68K_ADDRESS_LOW = (S16)VALUE;

    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_BASE);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVEA, 32, EA, AY)
{
    unsigned VALUE = READ_IMM_32();
    M68K_ADDRESS_LOW = VALUE;

    M68K_BASE_ADDRESS_HOOK(M68K_REG_A);
    M68K_EA_PRINT_HOOK(M68K_REG_A);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVE_CCR, 16, DA, 0)
{
    int DESTINATION = M68K_LOW_BITMASK;
    int SRC = M68K_MASK_OUT_ABOVE_16(DESTINATION);

    M68K_WRITE_16(DESTINATION, SRC);

    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);
    M68K_CCR_HOOK();

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVE_SR, 16, DA, 0)
{
    if(M68K_FLAG_S)
    {
        unsigned SR = M68K_READ_16(M68K_DATA_HIGH);
        M68K_SET_SR_IRQ(SR);
        return;
    }

    M68K_FLAG_X = (M68K_REG_SR & 0x0010) ? 1 : 0;
    M68K_FLAG_N = (M68K_REG_SR & 0x0008) ? 1 : 0;
    M68K_FLAG_Z = (M68K_REG_SR & 0x0004) ? 1 : 0;
    M68K_FLAG_V = (M68K_REG_SR & 0x0002) ? 1 : 0;
    M68K_FLAG_C = (M68K_REG_SR & 0x0001) ? 1 : 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
}

M68K_MAKE_OPCODE(MOVE_USP, 32, DA, 0)
{
    if(M68K_FLAG_S)
    {
        M68K_ADDRESS_HIGH = M68K_REG_USP;
        return;
    }
}

M68K_MAKE_OPCODE(MOVEM, 16, DA, 0)
{
    unsigned INDEX = 0;
    unsigned REGISTERS = READ_IMM_16();
    unsigned EA = M68K_ADDRESS_HIGH;

    for(; INDEX < 16; INDEX++)
    {
        if(REGISTERS & (1 << INDEX))
        {
            EA = REGISTERS;
            M68K_WRITE_16(M68K_REG_DA[INDEX], M68K_MASK_OUT_ABOVE_16(EA));
        }
    }

    M68K_ADDRESS_HIGH = EA;
    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);

    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(MOVEM, 32, DA, 0)
{
    unsigned INDEX = 0;
    unsigned REGISTERS = READ_IMM_32();
    unsigned EA = M68K_ADDRESS_HIGH;

    for(; INDEX < 16; INDEX++)
    {
        if(REGISTERS & (1 << INDEX))
        {
            EA = REGISTERS;
            M68K_WRITE_32(M68K_REG_DA[INDEX], M68K_MASK_OUT_ABOVE_32(EA));
        }
    }

    M68K_ADDRESS_HIGH = EA;
    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);

    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(MOVE, 32, ABS, D)
{
    unsigned RESULT = M68K_DATA_HIGH;
    unsigned EA = READ_IMM_32();

    M68K_FLAG_N = M68K_BIT_SHIFT_N_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_WRITE_32(RESULT, EA);
    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(MOVEM, 16, POST_INC, 0)
{
    unsigned INDEX = 0;
    unsigned LIST = READ_IMM_16();
    unsigned EA = M68K_ADDRESS_HIGH;

    for(; INDEX < 16; INDEX++)
    {
        EA = LIST;
        M68K_WRITE_16(M68K_REG_BASE[INDEX], M68K_MASK_OUT_ABOVE_32(EA));
    }

    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVEM, 32, POST_INC, 0)
{
    unsigned INDEX = 0;
    unsigned LIST = READ_IMM_32();
    unsigned EA = M68K_ADDRESS_HIGH;

    for(; INDEX < 16; INDEX++)
    {
        EA = LIST;
        M68K_WRITE_32(M68K_REG_BASE[INDEX], M68K_MASK_OUT_ABOVE_32(EA));
    }

    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVEM, 16, POST_INC, A)
{
    unsigned INDEX = 0;
    unsigned LIST = READ_IMM_16();
    unsigned EA = M68K_ADDRESS_HIGH;

    for(; INDEX < 16; INDEX++)
    {
        EA = LIST;
        EA += 2;
        M68K_WRITE_16(M68K_REG_BASE[INDEX], M68K_MASK_OUT_ABOVE_16(EA));
    }

    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVEM, 32, POST_INC, A)
{
    unsigned INDEX = 0;
    unsigned LIST = READ_IMM_32();
    unsigned EA = M68K_ADDRESS_HIGH;

    for(; INDEX < 16; INDEX++)
    {
        EA = LIST;
        EA += 4;
        M68K_WRITE_32(M68K_REG_BASE[INDEX], M68K_MASK_OUT_ABOVE_32(EA));
    }

    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVEP, 16, ER, 0)
{
    unsigned EA = M68K_READ_16(M68K_DATA_LOW);
    unsigned* DEST = &M68K_DATA_LOW;

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | ((M68K_READ_8(EA) << 8) + M68K_READ_8(EA + 2));
    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVEP, 32, ER, 0)
{
    unsigned EA = M68K_READ_32(M68K_DATA_LOW);
    unsigned* DEST = &M68K_DATA_LOW;

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | ((M68K_READ_16(EA) << 8) + M68K_READ_16(EA + 2));
    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MOVEQ, 32, D, 0)
{
    unsigned RESULT = M68K_DATA_HIGH = M68K_MASK_OUT_ABOVE_8(M68K_REG_IR);
    
    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_D);
}

M68K_MAKE_OPCODE(MOVE, 8, D, IMM)
{
    unsigned RESULT = M68K_ADDRESS_HIGH;
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = ~M68K_MASK_OUT_ABOVE_8(*DEST) | RESULT;
    
    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(MOVE, 16, D, IMM)
{
    unsigned RESULT = M68K_ADDRESS_HIGH;
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = ~M68K_MASK_OUT_ABOVE_16(*DEST) | RESULT;
    
    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(MOVE, 32, D, IMM)
{
    unsigned RESULT = M68K_ADDRESS_HIGH;
    unsigned* DEST = &M68K_DATA_HIGH;

    *DEST = ~M68K_MASK_OUT_ABOVE_32(*DEST) | RESULT;
    
    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 8;
}

M68K_MAKE_OPCODE(MULS, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = M68K_READ_16(M68K_DATA_HIGH);
    unsigned RESULT = M68K_MASK_OUT_ABOVE_32(SRC * M68K_READ_16(M68K_MASK_OUT_ABOVE_16(*DEST)));

    *DEST = SRC;

    M68K_FLAG_Z = RESULT;
    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(MULU, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH);
    unsigned RESULT = SRC = M68K_MASK_OUT_ABOVE_16(*DEST);

    *DEST = RESULT;

    M68K_FLAG_Z = RESULT;
    M68K_FLAG_N = M68K_BIT_SHIFT_N_32(RESULT);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(NBCD, 8, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned RESULT = -*DEST - M68K_FLAG_X; 

    if(RESULT | *DEST && 0x0F)
    {
        M68K_FLAG_V = RESULT;
        RESULT = (RESULT & 0xF0) + 6;

        RESULT = M68K_MASK_OUT_ABOVE_8(*DEST);

        M68K_FLAG_C = 0;
        M68K_FLAG_V = 0;
        M68K_FLAG_N = 0; 
        M68K_FLAG_X = 0;
    }
}

M68K_MAKE_OPCODE(NEG, 8, EA, 0)
{
    unsigned EA = M68K_LEA_AL();
    unsigned SRC = M68K_READ_8(M68K_EA());
    unsigned RESULT = SRC - 0;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);

    M68K_WRITE_8(RESULT, EA);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(NEG, 16, EA, 0)
{
    unsigned EA = M68K_LEA_AL();
    unsigned SRC = M68K_READ_16(M68K_EA());
    unsigned RESULT = SRC - 0;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);

    M68K_WRITE_16(RESULT, EA);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(NEG, 32, EA, 0)
{
    unsigned EA = M68K_LEA_AL();
    unsigned SRC = M68K_READ_32(M68K_EA());
    unsigned RESULT = SRC - 0;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);

    M68K_WRITE_32(RESULT, EA);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(NEG, 8, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned RESULT = *DEST - 0;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_C = M68K_FLAG_X = (RESULT == 0);
    M68K_FLAG_V = (*DEST && RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);

    *DEST = M68K_FLAG_Z;
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(NEG, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned RESULT = *DEST - 0;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_C = M68K_FLAG_X = (RESULT == 0);
    M68K_FLAG_V = (*DEST && RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);

    *DEST = M68K_FLAG_Z;

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(NEG, 32, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned RESULT = *DEST - 0;

    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_C = M68K_FLAG_X = (RESULT == 0);
    M68K_FLAG_V = (*DEST && RESULT == 0);
    M68K_FLAG_Z = (RESULT == 0);

    *DEST = M68K_FLAG_Z;

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(NEG, 8, AN, EA)
{
    unsigned EA = M68K_ADDRESS_HIGH;
    unsigned SRC = M68K_READ_8(EA);
    unsigned RESULT = SRC - 0;

    M68K_FLAG_N = M68K_BIT_SHIFT_N_8(RESULT);
    M68K_FLAG_Z = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_V = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;

    M68K_CCR_HOOK();
    M68K_WRITE_8(EA, M68K_FLAG_Z);
}

M68K_MAKE_OPCODE(NEG, 16, AN, EA)
{
    unsigned EA = M68K_ADDRESS_HIGH;
    unsigned SRC = M68K_READ_16(EA);
    unsigned RESULT = SRC - 0;

    M68K_FLAG_N = M68K_BIT_SHIFT_N_16(RESULT);
    M68K_FLAG_Z = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_V = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;

    M68K_CCR_HOOK();
    M68K_WRITE_16(EA, M68K_FLAG_Z);
}

M68K_MAKE_OPCODE(NEG, 32, AN, EA)
{
    unsigned EA = M68K_ADDRESS_HIGH;
    unsigned SRC = M68K_READ_32(EA);
    unsigned RESULT = SRC - 0;

    M68K_FLAG_N = M68K_BIT_SHIFT_N_32(RESULT);
    M68K_FLAG_Z = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_V = M68K_MASK_OUT_ABOVE_32(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;

    M68K_CCR_HOOK();
    M68K_WRITE_32(EA, M68K_FLAG_Z);
}

M68K_MAKE_OPCODE(NEG, 8, EA, POST_INC)
{
    unsigned SRC = M68K_READ_8(M68K_EA());
    unsigned DEST = M68K_ADDRESS_HIGH;
    unsigned RESULT = SRC - DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);

    M68K_WRITE_8(RESULT, DEST);
}

M68K_MAKE_OPCODE(NEG, 16, EA, POST_INC)
{
    unsigned SRC = M68K_READ_16(M68K_EA());
    unsigned DEST = M68K_ADDRESS_HIGH;
    unsigned RESULT = SRC - DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);

    M68K_WRITE_16(RESULT, DEST);
}

M68K_MAKE_OPCODE(NEG, 32, EA, POST_INC)
{
    unsigned SRC = M68K_READ_32(M68K_EA());
    unsigned DEST = M68K_ADDRESS_HIGH;
    unsigned RESULT = SRC - DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);

    M68K_WRITE_32(RESULT, DEST);
}

M68K_MAKE_OPCODE(NEG, 8, EA, PRE_DEC)
{
    unsigned SRC = M68K_READ_8(M68K_EA());
    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = SRC - DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);

    M68K_WRITE_8(RESULT, DEST);
}

M68K_MAKE_OPCODE(NEG, 16, EA, PRE_DEC)
{
    unsigned SRC = M68K_READ_16(M68K_EA());
    unsigned DEST = M68K_ADDRESS_LOW;
    unsigned RESULT = SRC - DEST;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_X = M68K_FLAG_C;
    M68K_FLAG_V = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);

    M68K_WRITE_16(RESULT, DEST);
}

M68K_MAKE_OPCODE(NEG, 32, EA, PRE_DEC)
{
    unsigned EA = M68K_ADDRESS_LOW;
    unsigned SRC = M68K_READ_32(EA);
    unsigned RESULT = SRC - 0;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_C = M68K_FLAG_X = (((SRC & RESULT) | (RESULT >> 23)));
    M68K_FLAG_V = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = M68K_BIT_SHIFT_32(RESULT);

    M68K_CCR_HOOK();
    M68K_WRITE_32(RESULT, M68K_FLAG_Z);
}

M68K_MAKE_OPCODE(NEGX, 8, DA, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8(*DEST) - (U8)M68K_FLAG_X;

    M68K_FLAG_N = READ_IMM_8();
    M68K_FLAG_X = M68K_FLAG_C = READ_IMM_8();
    M68K_FLAG_V = *DEST & RESULT;

    RESULT = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_Z |= RESULT;

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | RESULT;
}

M68K_MAKE_OPCODE(NEGX, 16, DA, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16(*DEST) - (U16)M68K_FLAG_X;

    M68K_FLAG_N = READ_IMM_16();
    M68K_FLAG_X = M68K_FLAG_C = READ_IMM_16();
    M68K_FLAG_V = *DEST & RESULT;

    RESULT = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_Z |= RESULT;

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | RESULT;
}

M68K_MAKE_OPCODE(NEGX, 32, DA, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned RESULT = M68K_MASK_OUT_ABOVE_32(*DEST) - (U32)M68K_FLAG_X;

    M68K_FLAG_N = READ_IMM_32();
    M68K_FLAG_X = M68K_FLAG_C = READ_IMM_32();
    M68K_FLAG_V = *DEST & RESULT;

    RESULT = M68K_MASK_OUT_ABOVE_32(RESULT);
    M68K_FLAG_Z |= RESULT;

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | RESULT;
}

M68K_MAKE_OPCODE(NOT, 8, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8(*DEST);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;

    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(NOT, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16(*DEST);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;

    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(NOT, 32, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned RESULT = *DEST = M68K_MASK_OUT_ABOVE_32(*DEST);

    M68K_FLAG_N = M68K_BIT_SHIFT_N_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
}

M68K_MAKE_OPCODE(NOT, 8, EA, 0)
{
    unsigned* DEST = &M68K_EA();
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8(*DEST);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;

    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(NOT, 16, EA, 0)
{
    unsigned* DEST = &M68K_EA();
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16(*DEST);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;

    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(NOT, 32, EA, 0)
{
    unsigned* DEST = &M68K_EA();
    unsigned RESULT = M68K_MASK_OUT_ABOVE_32(*DEST);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_Z = RESULT;

    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(NOP, 0, 0, 0)
{
    #undef M68K_EMULATE_TRACE_MODE
    M68K_TRACE_0();
}

M68K_MAKE_OPCODE(OR, 8, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8((M68K_DATA_LOW |= M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH)));

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(OR, 16, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16((M68K_DATA_LOW |= M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH)));

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(OR, 32, D, 0)
{
    unsigned RESULT = M68K_DATA_LOW ^= M68K_DATA_HIGH;

    M68K_FLAG_N = M68K_BIT_SHIFT_N_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(OR, 8, DN, DY)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8((M68K_DATA_LOW |= M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH)));

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(OR, 16, DN, DY)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16((M68K_DATA_LOW |= M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH)));

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(OR, 32, DN, DY)
{
    unsigned RESULT = M68K_DATA_LOW ^= M68K_DATA_HIGH;

    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(ORI, 8, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8((M68K_DATA_LOW |= M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH)));

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ORI, 16, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16((M68K_DATA_LOW |= M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH)));

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ORI, 32, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_32((M68K_DATA_LOW |= M68K_MASK_OUT_ABOVE_32(M68K_DATA_HIGH)));

    M68K_FLAG_N = READ_IMM_32();
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(ORI, 8, IMM, EA)
{
    unsigned SRC = READ_IMM_8();
    unsigned EA = M68K_ADDRESS_HIGH;
    unsigned RESULT = SRC ^ M68K_READ_8(EA);

    M68K_WRITE_8(EA, RESULT);

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_CCR_HOOK();
    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(ORI, 16, IMM, EA)
{
    unsigned SRC = READ_IMM_16();
    unsigned EA = M68K_ADDRESS_HIGH;
    unsigned RESULT = SRC ^ M68K_READ_16(EA);

    M68K_WRITE_16(EA, RESULT);

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_CCR_HOOK();
    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(ORI, 32, IMM, EA)
{
    unsigned SRC = READ_IMM_32();
    unsigned EA = M68K_ADDRESS_HIGH;
    unsigned RESULT = SRC ^ M68K_READ_32(EA);

    M68K_WRITE_32(EA, RESULT);

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;

    M68K_CCR_HOOK();
    M68K_REG_PC += 8;
}

M68K_MAKE_OPCODE(ORI_CCR, 8, 0, 0)
{
    int DESTINATION = M68K_LOW_BITMASK;
    int SRC = M68K_MASK_OUT_ABOVE_8(DESTINATION);

    M68K_FLAG_X = M68K_BIT_4(SRC) | 0;
    M68K_FLAG_N = M68K_BIT_3(SRC) | 0;
    M68K_FLAG_Z = M68K_BIT_2(SRC) | 0;
    M68K_FLAG_V = M68K_BIT_1(SRC) | 0;
    M68K_FLAG_C = M68K_BIT_0(SRC) | 0;

    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(ORI_SR, 16, 0, 0)
{  
    if(M68K_FLAG_S)
    {
        unsigned SR = M68K_READ_16(M68K_DATA_HIGH);
        M68K_SET_SR_IRQ(SR);
        return;
    }

    M68K_FLAG_X = (M68K_REG_SR & 0x0010) ? 1 : 0;
    M68K_FLAG_N = (M68K_REG_SR & 0x0008) ? 1 : 0;
    M68K_FLAG_Z = (M68K_REG_SR & 0x0004) ? 1 : 0;
    M68K_FLAG_V = (M68K_REG_SR & 0x0002) ? 1 : 0;
    M68K_FLAG_C = (M68K_REG_SR & 0x0001) ? 1 : 0;

    M68K_REG_PC += 2;
}


M68K_MAKE_OPCODE(PEA, 32, D, 0)
{
    unsigned EA = M68K_READ_32(M68K_DATA_HIGH);
    M68K_WRITE_32(EA, M68K_DATA_HIGH);

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(RESET, 0, 0, 0)
{
    M68K_PULSE_RESET();
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ROL, 8, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned BASE_SHIFT = (((M68K_REG_IR >> 9) - 1) & 7) + 1;

    unsigned SRC = M68K_MASK_OUT_ABOVE_8(*DEST);
    unsigned RESULT = M68K_READ_8(SRC);

    *DEST = M68K_MASK_OUT_ABOVE_8(RESULT);

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = SRC << (9 - BASE_SHIFT);
    M68K_FLAG_V = 0;

    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
}

M68K_MAKE_OPCODE(ROL, 16, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned BASE_SHIFT = (((M68K_REG_IR >> 9) - 1) & 7) + 1;

    unsigned SRC = M68K_MASK_OUT_ABOVE_16(*DEST);
    unsigned RESULT = M68K_READ_16(SRC);

    *DEST = M68K_MASK_OUT_ABOVE_16(RESULT);

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = SRC << (9 - BASE_SHIFT);
    M68K_FLAG_V = 0;

    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
}

M68K_MAKE_OPCODE(ROL, 32, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned BASE_SHIFT = (((M68K_REG_IR >> 9) - 1) & 7) + 1;

    unsigned SRC = M68K_MASK_OUT_ABOVE_32(*DEST);
    unsigned RESULT = M68K_READ_32(SRC);

    *DEST = M68K_MASK_OUT_ABOVE_32(RESULT);

    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_C = SRC << (9 - BASE_SHIFT);
    M68K_FLAG_V = 0;

    M68K_BASE_ADDRESS_HOOK(M68K_REG_DA);
}

M68K_MAKE_OPCODE(ROL, 8, R, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned BASE_SHIFT = M68K_DATA_LOW & 0x3F;
    unsigned NEW_SHIFT = BASE_SHIFT & 7;

    unsigned SRC = M68K_MASK_OUT_ABOVE_8(*DEST);
    unsigned RESULT = M68K_READ_8(SRC);

    if(BASE_SHIFT != 0 && NEW_SHIFT != 0)
    {
        *DEST = ~M68K_MASK_OUT_ABOVE_8(*DEST) | RESULT;
        M68K_FLAG_C = SRC << NEW_SHIFT;
        M68K_FLAG_N = (RESULT == 0);
        M68K_FLAG_Z = SRC;
        M68K_FLAG_V = 0;
        return;
    }

    M68K_FLAG_C = 0;
    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (SRC == 0);
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(ROL, 16, R, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned BASE_SHIFT = M68K_DATA_LOW & 0x3F;
    unsigned NEW_SHIFT = BASE_SHIFT & 15;

    unsigned SRC = M68K_MASK_OUT_ABOVE_16(*DEST);
    unsigned RESULT = M68K_READ_16(SRC);

    if(BASE_SHIFT != 0 && NEW_SHIFT != 0)
    {
        *DEST = ~M68K_MASK_OUT_ABOVE_16(*DEST) | RESULT;
        M68K_FLAG_C = SRC << NEW_SHIFT >> 8;
        M68K_FLAG_N = (RESULT == 0);
        M68K_FLAG_Z = SRC;
        M68K_FLAG_V = 0;
        return;
    }

    M68K_FLAG_C = 0;
    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (SRC == 0);
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(ROL, 32, R, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned BASE_SHIFT = M68K_DATA_LOW & 0x3F;
    unsigned NEW_SHIFT = BASE_SHIFT & 31;

    unsigned SRC = M68K_MASK_OUT_ABOVE_32(*DEST);
    unsigned RESULT = M68K_READ_32(SRC);

    if(BASE_SHIFT != 0 && NEW_SHIFT != 0)
    {
        *DEST = ~M68K_MASK_OUT_ABOVE_16(*DEST) | RESULT;
        M68K_FLAG_C = (SRC >> ((NEW_SHIFT - 32) & 0x1F)) >> 8;
        M68K_FLAG_N = (RESULT == 0);
        M68K_FLAG_Z = (SRC);
        M68K_FLAG_V = 0;
        return;
    }

    M68K_FLAG_C = 0;
    M68K_FLAG_N = (RESULT == 0);
    M68K_FLAG_Z = (SRC == 0);
    M68K_FLAG_V = 0;

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(ROXL, 8, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = M68K_READ_8(M68K_DATA_HIGH);

    RESULT = ((U32)RESULT + SHIFT);
    RESULT = M68K_MASK_OUT_ABOVE_8(RESULT);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(ROXL, 16, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = M68K_READ_16(M68K_DATA_HIGH);

    RESULT = ((U32)RESULT + SHIFT);
    RESULT = M68K_MASK_OUT_ABOVE_16(RESULT);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(ROXL, 32, S, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SHIFT = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = M68K_READ_32(M68K_DATA_HIGH);

    RESULT = ((U32)RESULT + SHIFT);
    RESULT = M68K_MASK_OUT_ABOVE_32(RESULT);

    *DEST = RESULT;

    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_Z = RESULT;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(RTS, 0, 0, 0)
{
    M68K_BASE_RTS_HOOK(M68K_REG_PC);
}

M68K_MAKE_OPCODE(RTE, 32, 0, 0)
{
    if(M68K_FLAG_S)
    {
        unsigned NEW_PC = 0;
        M68K_JUMP(M68K_MASK_OUT_ABOVE_32(M68K_READ_32(M68K_DATA_HIGH)));
        M68K_JUMP(NEW_PC);
    }
}

M68K_MAKE_OPCODE(RTR, 32, 0, 0)
{
    int DESTINATION = M68K_LOW_BITMASK;
    int SRC = M68K_MASK_OUT_ABOVE_32(DESTINATION);

    M68K_FLAG_X = M68K_BIT_4(SRC) | 0;
    M68K_FLAG_N = M68K_BIT_3(SRC) | 0;
    M68K_FLAG_Z = M68K_BIT_2(SRC) | 0;
    M68K_FLAG_V = M68K_BIT_1(SRC) | 0;
    M68K_FLAG_C = M68K_BIT_0(SRC) | 0;
}

M68K_MAKE_OPCODE(SBCD, 8, RR, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = M68K_DATA_HIGH;

    unsigned RESULT = M68K_LOW_NIBBLE(DEST) - M68K_LOW_NIBBLE(SRC) - M68K_READ_32(M68K_DATA_HIGH);

    RESULT += M68K_READ_32(M68K_HIGH_NIBBLE(*DEST) | M68K_READ_32(M68K_HIGH_NIBBLE(SRC)));
    M68K_FLAG_V &= RESULT;
    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z |= RESULT;

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | RESULT;
}

M68K_MAKE_OPCODE(STOP, 0, 0, 0)
{
    if(M68K_FLAG_S)
    {
        unsigned STOP_STATUS = READ_IMM_16();
        M68K_CPU_STOPPED |= 1;
        M68K_SET_SR(STOP_STATUS);
    }

    return;
}

M68K_MAKE_OPCODE(SUB, 8, D, 0)
{
    unsigned SRC_REG = (M68K_REG_IR >> 9) & 7;
    unsigned DEST_REG = M68K_REG_IR & 7;

    unsigned SRC = M68K_GET_REGISTERS(&CPU, SRC_REG) & 0xFF;
    unsigned DEST = M68K_GET_REGISTERS(&CPU, DEST_REG) & 0xFF;

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (RESULT >> 7) & 1;
    M68K_FLAG_Z = (RESULT == 0);      
    M68K_FLAG_V = ((DEST ^ SRC) & (DEST ^ RESULT)) >> 7; 
    M68K_FLAG_C = (RESULT > 0xFF);  
    M68K_FLAG_X = M68K_FLAG_C;        

    M68K_SET_REGISTERS(DEST_REG, RESULT);

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(SUB, 16, D, 0)
{
    unsigned SRC_REG = (M68K_REG_IR >> 9) & 7;
    unsigned DEST_REG = M68K_REG_IR & 7;

    unsigned SRC = M68K_GET_REGISTERS(&CPU, SRC_REG) & 0xFFFF;
    unsigned DEST = M68K_GET_REGISTERS(&CPU, DEST_REG) & 0xFFFF;

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = (RESULT == 0);      
    M68K_FLAG_V = ((DEST ^ SRC) & (DEST ^ RESULT)) >> 15; 
    M68K_FLAG_C = (RESULT > 0xFFFFFFFF);  
    M68K_FLAG_X = M68K_FLAG_C;        

    M68K_SET_REGISTERS(DEST_REG, RESULT);
}

M68K_MAKE_OPCODE(SUB, 32, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = M68K_MASK_OUT_ABOVE_32(M68K_DATA_HIGH);

    unsigned RESULT = *DEST - SRC;

    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = M68K_READ_32(RESULT);
    M68K_FLAG_V = (-(U32)SRC + *DEST + RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(SUB, 8, D, EA)
{
    unsigned* BOUND = &M68K_DATA_HIGH;
    unsigned SRC = READ_IMM_8();
    unsigned DEST = M68K_MASK_OUT_ABOVE_8(*BOUND);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = ((SRC - DEST - RESULT) == 0);
    M68K_FLAG_Z = M68K_BIT_SHIFT_8(RESULT);

    M68K_CCR_HOOK();
    *BOUND = M68K_MASK_OUT_BELOW_8(*BOUND) | M68K_FLAG_Z;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(SUB, 16, D, EA)
{
    unsigned* BOUND = &M68K_DATA_HIGH;
    unsigned SRC = READ_IMM_16();
    unsigned DEST = M68K_MASK_OUT_ABOVE_16(*BOUND);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = ((SRC - DEST - RESULT) == 0);
    M68K_FLAG_Z = M68K_BIT_SHIFT_16(RESULT);

    M68K_CCR_HOOK();
    *BOUND = M68K_MASK_OUT_BELOW_16(*BOUND) | M68K_FLAG_Z;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(SUB, 32, D, EA)
{
    unsigned* BOUND = &M68K_DATA_HIGH;
    unsigned SRC = READ_IMM_32();
    unsigned DEST = M68K_MASK_OUT_ABOVE_32(*BOUND);

    unsigned RESULT = DEST - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = ((SRC - DEST - RESULT) == 0);
    M68K_FLAG_Z = M68K_BIT_SHIFT_32(RESULT);

    M68K_CCR_HOOK();
    *BOUND = M68K_MASK_OUT_BELOW_32(*BOUND) | M68K_FLAG_Z;
    
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(SUBA, 16, DA, 0)
{
    unsigned* DATA_DEST = &M68K_DATA_LOW;
    *DATA_DEST = M68K_MASK_OUT_ABOVE_32(*DATA_DEST - M68K_READ_16(M68K_DATA_HIGH));

    M68K_REG_PC += 4;

    #ifndef USE_ADDRESSING

    unsigned* ADDRESS_DEST = &M68K_ADDRESS_LOW;
    *ADDRESS_DEST = M68K_MASK_OUT_ABOVE_32(*ADDRESS_DEST - M68K_READ_16(M68K_ADDRESS_HIGH));

    #endif
}

M68K_MAKE_OPCODE(SUBA, 32, DA, 0)
{
    unsigned* DATA_DEST = &M68K_DATA_LOW;
    *DATA_DEST = M68K_MASK_OUT_ABOVE_32(*DATA_DEST - M68K_READ_32(M68K_DATA_HIGH));

    M68K_REG_PC += 4;

    #ifndef USE_ADDRESSING

    unsigned* ADDRESS_DEST = &M68K_ADDRESS_LOW;
    *ADDRESS_DEST = M68K_MASK_OUT_ABOVE_32(*ADDRESS_DEST - M68K_READ_32(M68K_ADDRESS_HIGH));

    #endif

}

M68K_MAKE_OPCODE(SUBI, 8, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = READ_IMM_8();
    unsigned MASK = M68K_MASK_OUT_ABOVE_8(*DEST);
    unsigned RESULT = MASK - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = (SRC > MASK);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = (RESULT == 0);

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(SUBI, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = READ_IMM_16();
    unsigned MASK = M68K_MASK_OUT_ABOVE_16(*DEST);
    unsigned RESULT = MASK - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = (SRC > MASK);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = (RESULT == 0);

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);
    M68K_REG_PC += 2;
}

M68K_MAKE_OPCODE(SUBI, 32, D, 0)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = READ_IMM_32();
    unsigned MASK = M68K_MASK_OUT_ABOVE_32(*DEST);
    unsigned RESULT = MASK - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = (SRC > MASK);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = (RESULT == 0);

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);
    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(SUBI, 8, IMM, EA)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = READ_IMM_8();
    unsigned MASK = M68K_MASK_OUT_ABOVE_8(*DEST);
    unsigned RESULT = MASK - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = (SRC > MASK);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = (RESULT == 0);

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);

    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(SUBI, 16, IMM, EA)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = READ_IMM_16();
    unsigned MASK = M68K_MASK_OUT_ABOVE_16(*DEST);
    unsigned RESULT = MASK - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = (SRC > MASK);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = (RESULT == 0);

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);

    M68K_REG_PC += 6;
}

M68K_MAKE_OPCODE(SUBI, 32, IMM, EA)
{
    unsigned* DEST = &M68K_DATA_LOW;
    unsigned SRC = READ_IMM_32();
    unsigned MASK = M68K_MASK_OUT_ABOVE_32(*DEST);
    unsigned RESULT = MASK - SRC;

    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z = (RESULT == 0);
    M68K_FLAG_C = (SRC > MASK);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT == 0);
    M68K_FLAG_V = (RESULT == 0);

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | M68K_FLAG_Z;

    M68K_CCR_HOOK();
    M68K_BASE_ADDRESS_HOOK(M68K_REG_BASE);

    M68K_REG_PC += 8;
}

M68K_MAKE_OPCODE(SUBQ, 8, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = *DEST - SRC;

    M68K_FLAG_N = (RESULT >> 7) & 1;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT > *DEST);
    M68K_FLAG_V = ((*DEST ^ RESULT) & (~(*DEST ^ SRC)) & 0x80) != 0;

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | M68K_FLAG_Z;
}

M68K_MAKE_OPCODE(SUBQ, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = *DEST - SRC;

    M68K_FLAG_N = (RESULT >> 15) & 1;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT > *DEST);
    M68K_FLAG_V = ((*DEST ^ RESULT) & (~(*DEST ^ SRC)) & 0x8000) != 0;
    

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | M68K_FLAG_Z;
}

M68K_MAKE_OPCODE(SUBQ, 32, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = *DEST - SRC;

    M68K_FLAG_N = (RESULT >> 31) & 1;
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = (RESULT > *DEST);
    M68K_FLAG_V = ((*DEST ^ RESULT) & (~(*DEST ^ SRC)) & 0x80000000) != 0;
    
    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | M68K_FLAG_Z;
}

M68K_MAKE_OPCODE(SUBX, 8, RR, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = *DEST - SRC;

    M68K_FLAG_N = M68K_READ_8(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = M68K_READ_8(RESULT);
    M68K_FLAG_V = (-(U8)SRC + *DEST + RESULT);

    RESULT = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_Z |= RESULT;

    *DEST = M68K_MASK_OUT_ABOVE_8(*DEST) | RESULT;
}

M68K_MAKE_OPCODE(SUBX, 16, RR, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = *DEST - SRC;

    M68K_FLAG_N = M68K_READ_16(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = M68K_READ_16(RESULT);
    M68K_FLAG_V = (-(U16)SRC + *DEST + RESULT);

    RESULT = M68K_MASK_OUT_ABOVE_16(RESULT);
    M68K_FLAG_Z |= RESULT;

    *DEST = M68K_MASK_OUT_ABOVE_16(*DEST) | RESULT;
}

M68K_MAKE_OPCODE(SUBX, 32, RR, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;
    unsigned SRC = (((M68K_REG_IR >> 9) - 1) & 7) + 1;
    unsigned RESULT = *DEST - SRC;

    M68K_FLAG_N = M68K_READ_32(RESULT);
    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(RESULT);
    M68K_FLAG_X = M68K_FLAG_C = M68K_READ_32(RESULT);
    M68K_FLAG_V = (-(U32)SRC + *DEST + RESULT);

    RESULT = M68K_MASK_OUT_ABOVE_8(RESULT);
    M68K_FLAG_Z |= RESULT;

    *DEST = M68K_MASK_OUT_ABOVE_32(*DEST) | RESULT;
}

M68K_MAKE_OPCODE(SWAP, 16, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;

    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_32(*DEST << 16);
    *DEST = (*DEST >> 16) | M68K_FLAG_Z;

    M68K_FLAG_Z = *DEST;
    M68K_FLAG_N = (U32)*DEST;
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
}

M68K_MAKE_OPCODE(TRAP, 0, 0, 0)
{
    // GET THE CURRENT SR VALUE - WHICH WILL ALLOW THE SYSCALL
    // TO CLEAR THE TRACE LEVEL TEMPORARILY BEFORE APPLYING THE APPROPRIATE CALL

    M68K_SET_S_FLAG(4);
    M68K_FLAG_C = 0;
    M68K_FLAG_V = 0;
    M68K_FLAG_X = 0;
    M68K_FLAG_N = 0;
    M68K_FLAG_Z = 0;
    M68K_CCR_HOOK();
}

M68K_MAKE_OPCODE(TAS, 8, D, 0)
{
    unsigned* DEST = &M68K_DATA_HIGH;

    M68K_FLAG_Z = M68K_MASK_OUT_ABOVE_8(*DEST);
    M68K_FLAG_N = (U8)*DEST;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;
    *DEST |= 0x80;
}


M68K_MAKE_OPCODE(TST, 8, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_8(M68K_DATA_HIGH);
    
    M68K_FLAG_N = (U8)RESULT;
    M68K_FLAG_Z  = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(TST, 16, D, 0)
{
    unsigned RESULT = M68K_MASK_OUT_ABOVE_16(M68K_DATA_HIGH);
    
    M68K_FLAG_N = (U16)RESULT;
    M68K_FLAG_Z  = RESULT;
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(TST, 32, D, 0)
{
    unsigned RESULT = M68K_ADDRESS_LOW;
    
    M68K_FLAG_N = M68K_BIT_SHIFT_32(RESULT);
    M68K_FLAG_Z  = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(TST, 8, IMM, 0)
{
    unsigned RESULT = M68K_ADDRESS_LOW;
    
    M68K_FLAG_N = M68K_BIT_SHIFT_8(RESULT);
    M68K_FLAG_Z  = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(TST, 16, IMM, 0)
{
    unsigned RESULT = M68K_ADDRESS_LOW;
    
    M68K_FLAG_N = M68K_BIT_SHIFT_16(RESULT);
    M68K_FLAG_Z  = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(TST, 32, IMM, 0)
{
    unsigned RESULT = M68K_ADDRESS_LOW;
    
    M68K_FLAG_N = M68K_BIT_SHIFT_N_32(RESULT);
    M68K_FLAG_Z  = (RESULT == 0);
    M68K_FLAG_V = 0;
    M68K_FLAG_C = 0;

    M68K_REG_PC += 4;
}

M68K_MAKE_OPCODE(UNLK, 32, 0, 0)
{
    unsigned* DEST = &M68K_ADDRESS_HIGH;
    unsigned* RANGE = &M68K_ADDRESS_LOW;

    *RANGE = *DEST;
    *DEST = M68K_READ_32(M68K_ADDRESS_HIGH);
}

/* =============================================== */
/*              OPCODE MISC. FUNCTIONS             */
/* =============================================== */

/* THE MAIN ENCOMPASSING OPCODE HANDLER TABLE */
/* THIS IS WHAT THE EMULATION WILL USE IN ORDER TO EVOKE THE MASK TYPE, LENGTH */
/* MATCH AND CYCLE COUNTS PER INSTRUCTION */

#ifndef USE_OPCODE_HANDLER_TABLE

OPCODE_HANDLER M68K_OPCODE_HANDLER_TABLE[] =
{
    // OPCODE                   MASK        MATCH       CYCLES
    {ABCD_8_RR_0,               0xF1F8,     0xC100,     6},  // ABCD Dy,Dx
    {ADD_8_EA_0,                0xF1FF,     0xD039,     4},  // ADD.B <ea>,Dn
    {ADD_16_EA_0,               0xF1FF,     0xD079,     8},  // ADD.W <ea>,Dn
    {ADD_32_EA_0,               0xF1FF,     0xD0B9,     12},  // ADD.L <ea>,Dn
    {ADD_8_D_0,                 0xF1F8,     0xD000,     8},  // ADD.B Dn, Dm
    {ADD_16_D_0,                0xF1F8,     0xD040,     8},  // ADD.W Dn, Dm
    {ADD_32_D_0,                0xF1F8,     0xD080,     8},  // ADD.L Dn, Dm
    {ADD_8_EA_DISP,             0xF1F8,     0xD010,     8},  // ADD.B (An), Dy
    {ADD_16_EA_DISP,            0xF1F8,     0xD050,     8},  // ADD.W (An), Dy
    {ADD_32_EA_DISP,            0xF1F8,     0xD090,     20},  // ADD.L (An), Dy
    {ADD_8_D_EA,                0xF1F8,     0xD110,     8},  // ADD.B Dn, (Ay)
    {ADD_16_D_EA,               0xF1F8,     0xD150,     8},  // ADD.W Dn, (Ay)
    {ADD_32_D_EA,               0xF1F8,     0xD190,     8},  // ADD.L Dn, (Ay)
    {ADD_8_D_EA_POST_INC,       0xF1F8,     0xD118,     8},  // ADD.B Dn, (Ay)+
    {ADD_16_D_EA_POST_INC,      0xF1F8,     0xD158,     8},  // ADD.W Dn, (Ay)+
    {ADD_32_D_EA_POST_INC,      0xF1F8,     0xD198,     8},  // ADD.L Dn, (Ay)+
    {ADD_8_D_EA_PRE_INC,        0xF1F8,     0xD018,     8},  // ADD.B (An)+, Dy
    {ADD_16_D_EA_PRE_INC,       0xF1F8,     0xD058,     8},  // ADD.W (An)+, Dy
    {ADD_32_D_EA_PRE_INC,       0xF1F8,     0xD098,     12},  // ADD.L (An)+, Dy
    {ADD_8_D_EA_PRE_DEC,        0xF1F8,     0xD120,     8},  // ADD.B Dn, -(Ay)
    {ADD_16_D_EA_PRE_DEC,       0xF1F8,     0xD160,     8},  // ADD.W Dn, -(Ay)
    {ADD_32_D_EA_PRE_DEC,       0xF1F8,     0xD1A0,     8},  // ADD.L Dn, -(Ay)
    {ADD_16_PRE_DEC_D,          0xF1C0,     0xD068,     12}, // ADD.W -(An), Dy 
    {ADD_32_PRE_DEC_D,          0xF1F8,     0xD0A0,     12}, // ADD.L -(An), Dy 
    {ADD_8_A_AI,                0xF1F8,     0xD028,     8},  // ADD.B $imm(An), Dy
    {ADD_16_A_AI,               0xF1F8,     0xD068,     8},  // ADD.W $imm(An), Dy
    {ADD_32_A_AI,               0xF1F8,     0xD0A8,     12},  // ADD.L $imm(An), Dy
    {ADDA_16_EA_0,              0xF1C0,     0xD0C0,     8},  // ADDA.W <ea>,An
    {ADDA_32_EA_0,              0xF1C0,     0xD1C0,     12},  // ADDA.L <ea>,An
    {ADDA_16_AN_AY,             0xF1F8,     0xD0C8,     8},  // ADDA.W An, Ay
    {ADDA_32_AN_AY,             0xF1F8,     0xD1C8,     8},  // ADDA.W An, Ay
    {ADDA_16_PD_AY,             0xF1F8,     0xD0E0,     14},  // ADDA.W -(An), Ay
    {ADDA_32_PD_AY,             0xF1F8,     0xD1E0,     16},  // ADDA.L -(An), Ay
    {ADDA_16_PI_AY,             0xF1F8,     0xD0D8,     12},  // ADDA.W (An)+, Ay
    {ADDA_32_PI_AY,             0xF1F8,     0xD1D8,     16},  // ADDA.L (An)+, Ay
    {ADDI_8_IMM_0,              0xFFF8,     0x0600,     8},  // ADDI.B #<data>,Dy
    {ADDI_16_IMM_0,             0xFFF8,     0x0640,     8},  // ADDI.W #<data>,Dy
    {ADDI_32_IMM_0,             0xFFF8,     0x0680,     16}, // ADDI.L #<data>,Dy
    {ADDI_8_IMM_EA,             0xFFFF,     0x0639,     16}, // ADDI.B #imm,<ea>
    {ADDI_16_IMM_EA,            0xFFFF,     0x0679,     16}, // ADDI.W #imm,<ea>
    {ADDI_32_IMM_EA,            0xFFFF,     0x06B9,     16}, // ADDI.L #imm,<ea>
    {ADDQ_8_D_0,                0xF1C0,     0x5000,     8},  // ADDQ.B #<data>,Dn
    {ADDQ_16_D_0,               0xF1C0,     0x5040,     8},  // ADDQ.W #<data>,Dn
    {ADDQ_32_D_0,               0xF1C0,     0x5080,     8},  // ADDQ.L #<data>,Dn
    {ADDX_8_RR_0,               0xF1F8,     0xD100,     4},  // ADDX.B Dy,Dx
    {ADDX_16_RR_0,              0xF1F8,     0xD140,     4},  // ADDX.W Dy,Dx
    {ADDX_32_RR_0,              0xF1F8,     0xD180,     8},  // ADDX.L Dy,Dx
    {AND_8_D_0,                 0xF1C0,     0xC000,     4},  // AND.B <ea>,Dn
    {AND_16_D_0,                0xF1C0,     0xC040,     4},  // AND.W <ea>,Dn
    {AND_32_D_0,                0xF1C0,     0xC080,     8},  // AND.L <ea>,Dn
    {ANDI_8_EA_0,               0xFFF8,     0x0200,     8},  // ANDI.B #<data>,<ea>
    {ANDI_16_EA_0,              0xFFF8,     0x0240,     8},  // ANDI.W #<data>,<ea>
    {ANDI_32_EA_0,              0xFFF8,     0x0280,     16}, // ANDI.L #<data>,<ea>
    {ANDI_CCR_8_CCR_0,          0xFFFF,     0x023C,     20}, // ANDI #<data>,CCR
    {ANDI_SR_16_SR_0,           0xFFFF,     0x027C,     20}, // ANDI #<data>,SR
    {ASL_8_ASR_0,               0xF1F8,     0xE120,     6},  // ASL.B Dn,Dy
    {ASL_16_ASR_0,              0xF1F8,     0xE160,     6},  // ASL.W Dn,Dy
    {ASL_32_ASR_0,              0xF1F8,     0xE1A0,     6},  // ASL.L Dn,Dy
    {ASR_8_ASR_0,               0xF1F8,     0xE020,     6},  // ASR.B Dn, Dy
    {ASR_16_ASR_0,              0xF1F8,     0xE060,     6},  // ASR.W Dn, Dy
    {ASR_32_ASR_0,              0xF1F8,     0xE0A0,     6},  // ASR.L Dn, Dy
    {BCC_16_0_0,                0xF000,     0x6000,     10}, // BCC <label>
    {BCC_32_0_0,                0xF000,     0x6000,     10}, // BCC <label> (32-bit displalrement)
    {BRA_8_0_0,                 0xFF00,     0x6000,     10}, // BRA <label>
    {BRA_16_0_0,                0xFFC0,     0x6000,     10}, // BRA <label> (16-bit displacement)!
    {BRA_32_0_0,                0xFFC0,     0x6000,     10}, // BRA <label> (32-bit displacement)
    {BEQ_8_0_0,                 0xFFFF,     0x6700,     10}, // BEQ <label>
    {BEQ_16_0_0,                0xFFFF,     0x67FF,     10}, // BEQ <label>
    {BEQ_32_0_0,                0xFFFF,     0x67FF,     20}, // BEQ <label>
    {BNE_8_0_0,                 0xFF00,     0x6600,     10},  // BNE <ea>
    {BNE_16_0_0,                0xFFFF,     0x66FF,     10},  // BNE <ea>
    {BNE_32_0_0,                0xFFFF,     0x66FF,     20},  // BNE <ea>
    {BSR_16_0_0,                0xFF00,     0x6100,     18}, // BSR <label>
    {BTST_8_D_0,                0xFFC0,     0x0800,     16},  // BTST Dn,<ea>
    {BTST_8_IMM_D,              0xFFF8,     0x0310,     12},  // BTST #<imm>, Dn
    {CHK_16_EA_0,               0xFFFF,     0x41B9,     10}, // CHK <ea>,Dn
    {CLR_8_D_0,                 0xFFF8,     0x4200,     4},  // CLR.B Dn
    {CLR_16_D_0,                0xFFF8,     0x4240,     4},  // CLR.W Dn
    {CLR_32_D_0,                0xFFF8,     0x4280,     6},  // CLR.L Dn
    {CLR_8_EA_0,                0xFFF0,     0x4230,     12},  // CLR.B <ea>
    {CLR_16_EA_0,               0xFFF0,     0x4270,     12},  // CLR.W <ea>
    {CLR_32_EA_0,               0xFFF0,     0x42B0,     12},  // CLR.L <ea>
    {CLR_8_EA_AN,               0xFFF0,     0x4210,     12},  // CLR.B (An)
    {CLR_16_EA_AN,              0xFFF0,     0x4250,     12},  // CLR.W (An)
    {CLR_32_EA_AN,              0xFFF0,     0x4290,     12},  // CLR.L (An)
    {CLR_8_PI_0,                0xFFF8,     0x4218,     12},  // CLR.B (An)+ 
    {CLR_16_PI_0,               0xFFF8,     0x4258,     12},  // CLR.W (An)+
    {CLR_32_PI_0,               0xFFF8,     0x4298,     12},  // CLR.L (An)+  
    {CLR_8_PD_0,                0xFFF8,     0x4220,     12},  // CLR.B -(An)
    {CLR_16_PD_0,               0xFFF8,     0x4260,     12},  // CLR.W -(An)
    {CLR_32_PD_0,               0xFFF8,     0x42A0,     12},  // CLR.L -(An)
    {CMP_8_EA_0,                0xF1FF,     0xB039,     4},  // CMP.B <ea>,Dn
    {CMP_16_EA_0,               0xF1FF,     0xB079,     4},  // CMP.W <ea>,Dn
    {CMP_32_EA_0,               0xF1FF,     0xB0B9,     6},  // CMP.L <ea>,Dn
    {CMP_8_D_0,                 0xF1F0,     0xB000,     4},  // CMP.B Dn,Dy
    {CMP_16_D_0,                0xF1F0,     0xB040,     4},  // CMP.W Dn,Dy
    {CMP_32_D_0,                0xF1F0,     0xB080,     4},  // CMP.L Dn,Dy
    {CMPA_16_DA_0,              0xF1C0,     0xB0C0,     6},  // CMPA.W <ea>,An
    {CMPA_32_DA_0,              0xF1C0,     0xB1C0,     6},  // CMPA.L <ea>,An
    {CMPA_16_AN_DISP,           0xFFF8,     0xB0E8,     6},  // CMPA.W #imm(An),Ay
    {CMPA_32_AN_DISP,           0xFFF8,     0xB1E8,     8},  // CMPA.L #imm(An),Ay
    {CMPA_16_PRE_DEC_EA,        0xF1F8,     0xB0E0,     12},  // CMPA.W -(An),Ay
    {CMPA_32_PRE_DEC_EA,        0xF1F8,     0xB1E0,     18},  // CMPA.L -(An),Ay
    {CMPA_16_POST_INC_EA,       0xF1F8,     0xB0D8,     10},  // CMPA.W -(An),Ay
    {CMPA_32_POST_INC_EA,       0xF1F8,     0xB1D8,     10},  // CMPA.l -(An),Ay
    {CMPI_8_DA_0,               0xFF00,     0x0C00,     8},  // CMPI.B #<data>,<ea>
    {CMPI_16_DA_0,              0xFF00,     0x0C40,     8},  // CMPI.W #<data>,<ea>
    {CMPI_32_DA_0,              0xFF00,     0x0C80,     14}, // CMPI.L #<data>,<ea>
    {CMPM_8_A_0,                0xF1F8,     0xB108,     12}, // CMPM.B (Ay)+,(Ax)+
    {CMPM_16_A_0,               0xF1F8,     0xB148,     12}, // CMPM.W (Ay)+,(Ax)+
    {CMPM_32_A_0,               0xF1F8,     0xB188,     20}, // CMPM.L (Ay)+,(Ax)+
    {DBCC_16_0_0,               0xF0F8,     0x50C8,     10}, // DBCC Dn,<label>
    {DIVS_16_D_0,               0xF1F8,     0x81C0,     4},  // DIVS.W Dn,Dy
    {DIVS_16_IMM_0,             0xF1FF,     0x81FC,     4},  // DIVS.W #imm, Dy
    {DIVU_16_D_0,               0xF1F8,     0x80C0,     4},  // DIVU.W <ea>, Dy
    {EOR_8_D_0,                 0xFFFF,     0xB101,     4},  // EOR.B Dn,<ea>
    {EOR_16_D_0,                0xFFFF,     0xB141,     4},  // EOR.W Dn,<ea>
    {EOR_32_D_0,                0xFFFF,     0xB181,     8},  // EOR.L Dn,<ea>
    {EORI_8_D_0,                0xFF00,     0x0A00,     8},  // EORI.B #<data>,<ea>
    {EORI_16_D_0,               0xFFF0,     0x0A40,     8},  // EORI.W #<data>,<ea>
    {EORI_32_D_0,               0xFF00,     0x0A80,     16}, // EORI.L #<data>,<ea>
    {EORI_CCR_8_0_0,            0xFFFF,     0x0A3C,     20}, // EORI #<data>,CCR
    {EORI_SR_16_0_0,            0xFFFF,     0x0A7C,     20}, // EORI #<data>,SR
    {EXG_32_DA_0,               0xF1F8,     0xC140,     6},  // EXG Dx,Dy
    {EXT_16_0_0,                0xFFF8,     0x4880,     4},  // EXT.W Dn
    {EXT_32_0_0,                0xFFFF,     0x48C0,     4},  // EXT.L Dn
    {ILLEGAL_0_0_0,             0xFFFF,     0x4AFC,     4},  // ILLEGAL
    {JMP_32_0_PC,               0xFFC0,     0x4EC0,     8},  // JMP <ea>
    {JSR_32_0_PC,               0xFFC0,     0x4E80,     16}, // JSR <ea>
    {LEA_32_AI_0,               0xF1FF,     0x41F9,     10},  // LEA <ea>, An
    {LINK_32_DA_0,              0xFFF8,     0x4E50,     16}, // LINK An,#<data>
    {LSL_8_S_0,                 0xF1F8,     0xE108,     6},  // LSL.B, Dn, Dy
    {LSL_16_S_0,                0xF1F8,     0xE148,     6},  // LSL.W, Dn, Dy
    {LSL_32_S_0,                0xF1F8,     0xE188,     6},  // LSL.L, Dn, Dy
    {LSR_8_S_0,                 0xF1F8,     0xE008,     6},  // LSR.B Dn,Dy
    {LSR_16_S_0,                0xF1F8,     0xE048,     6},  // LSR.W Dn,Dy
    {LSR_32_S_0,                0xF1F8,     0xE088,     8},  // LSR.L Dn,Dy
    {MOVE_8_D_0,                0xF1C0,     0x1000,     8},   // MOVE.B Dn,Dy 
    {MOVE_16_D_0,               0xF1C0,     0x3000,     8},   // MOVE.W Dn,Dy 
    {MOVE_32_D_0,               0xF1C0,     0x2000,     20},   // MOVE.L Dn,Dy
    {MOVE_8_D_EA,               0xF1FF,     0x1039,     12},  // MOVE.B <ea>, Dy
    {MOVE_16_D_EA,              0xF1FF,     0x3039,     12},  // MOVE.W <ea>, Dy
    {MOVE_32_D_EA,              0xF1FF,     0x2039,     24},  // MOVE.L <ea>, Dy
    {MOVE_8_D_I,                0xF1FF,     0x103C,     8},    // MOVE.B <imm> Dn
    {MOVE_16_D_I,               0xF1FF,     0x303C,     12},    // MOVE.W <imm> Dn
    {MOVE_32_D_I,               0xF1FF,     0x203C,     20},    // MOVE.L <imm> Dn
    {MOVE_16_PRE_DEC_IMM,       0xF1F8,     0x3028,     16},   // MOVE.W -(An), Dn
    {MOVE_32_PRE_DEC_IMM,       0xF1F8,     0x2028,     24},   // MOVE.L -(An), Dn
    {MOVE_32_D_POST_DEC,        0xF1F8,     0x2100,     14},  // MOVE.L, Dn, -(SP)
    {MOVE_8_PI_A,               0xF1F8,     0x10D8,     12},  // MOVE.B (An)+, (Ay)+
    {MOVE_16_PI_A,              0xF1F8,     0x30D8,     12},  // MOVE.W (An)+, (Ay)+
    {MOVE_32_PI_A,              0xF1F8,     0x20D8,     12},  // MOVE.L (An)+, (Ay)+
    {MOVEA_16_DA_0,             0xF1F0,     0x303C,     4},  // MOVEA.W Dn,Ay
    {MOVEA_32_DA_0,             0xF1C0,     0x203C,     4},  // MOVEA.L Dn,Ay
    {MOVEA_16_D_0,              0xF1C0,     0x3040,     8},  // MOVEA.W Dn,Ay 
    {MOVEA_32_D_0,              0xF1C0,     0x2040,     12}, // MOVEA.L Dn,Ay
    {MOVEA_16_AN_AY,            0xF1F8,     0x3050,     16}, // MOVEA.W (An),Ay
    {MOVEA_32_AN_AY,            0xF1F8,     0x2050,     16}, // MOVEA.L (An),Ay
    {MOVEA_16_POST_INC_AY,      0xF1F8,     0x3058,     16}, // MOVEA.W (An)+,Ay
    {MOVEA_16_PRE_DEC_AY,       0xF1F8,     0x3060,     20}, // MOVEA.W -(An),Ay
    {MOVEA_32_POST_INC_AY,      0xF1F8,     0x2058,     20}, // MOVEA.L (An)+,Ay
    {MOVEA_32_PRE_DEC_AY,       0xF1F8,     0x2060,     20}, // MOVEA.L -(An),Ay
    {MOVEA_16_EA_AY,            0xF1FF,     0x3079,     10},  // MOVEA.W <ea>,Ay    
    {MOVEA_32_EA_AY,            0xF1FF,     0x2079,     20},  // MOVEA.L <ea>,Ay 
    {MOVE_16_D_POST_INC,        0xF1F8,     0x3018,     10},   // MOVE.W (An)+,Dn
    {MOVE_32_POST_INC_0,        0xF1F8,     0x2018,     20},  // MOVE.L (An)+,Dn
    {MOVE_8_POST_INC_D,         0xFFF8,     0x10C0,     10},  // MOVE.B Dn, (Ay)+
    {MOVE_16_POST_INC_D,        0xF1C0,     0x30C0,     10},  // MOVE.W Dn, (Ay)+
    {MOVE_32_POST_INC_D,        0xF1C0,     0x20C0,     20},  // MOVE.L Dn, (Ay)+
    {MOVE_16_IMM_POST_INC,      0xF1FF,     0x30FC,     10},  // MOVE.W #imm, (An)+
    {MOVE_32_IMM_POST_INC,      0xF1FF,     0x20FC,     20},  // MOVE.L #imm, (An)+
    {MOVE_16_IMM_EA,            0xF1FF,     0x30BC,     20},  // MOVE.W #imm, (An)
    {MOVE_32_IMM_EA,            0xF1FF,     0x20BC,     24},  // MOVE.W #imm, (An)
    {MOVE_16_D_POST_DEC,        0xF1F8,     0x3100,     8},   // MOVE.W Dn, (-SP)
    {MOVE_16_D_PRE_DEC,         0xF1F8,     0x3020,     10},  // MOVE.W -(An), Dn
    {MOVE_32_D_PRE_DEC,         0xF1F8,     0x2020,     14},  // MOVE.L -(An), Dn
    {MOVE_32_ABS_D,             0xFFF8,     0x23C0,     20}, // MOVE.L Dn, <ea>
    {MOVE_CCR_16_DA_0,          0xFFFF,     0x44FC,     12}, // MOVE CCR,<ea>
    {MOVE_SR_16_DA_0,           0xFFC0,     0x40C0,     12}, // MOVE SR,<ea>
    {MOVE_USP_32_DA_0,          0xFFF8,     0x4E60,     4},  // MOVE USP,An
    {MOVEM_16_DA_0,             0xFFF0,     0x48B0,     8},  // MOVEM.W <ea>,Regs
    {MOVEM_32_DA_0,             0xFFF0,     0x48F0,     12}, // MOVEM.L <ea>,Regs
    {MOVEM_16_POST_INC_0,       0xFFF0,     0x48A0,     8},  // MOVEM.W <reglist>, (An)+
    {MOVEM_32_POST_INC_0,       0xFFF0,     0x48E0,     8},  // MOVEM.L <reglist>, (An)+
    {MOVEM_16_POST_INC_A,       0xFFF0,     0x4C90,     12}, // MOVEM.L (An)+, <reglist>
    {MOVEM_32_POST_INC_A,       0xFFF0,     0x4CD0,     12}, // MOVEM.L (An)+, <reglist>
    {MOVEP_16_ER_0,             0xFFF8,     0x0188,     16}, // MOVEP.W Dn, disp(An)
    {MOVEP_32_ER_0,             0xFFF8,     0x01C8,     24}, // MOVEP.L Dn, disp(An)
    {MOVEQ_32_D_0,              0xF100,     0x7000,     4},  // MOVEQ #<data>,Dn
    {MOVE_8_D_IMM,              0xFFFF,     0x13FC,     14}, // MOVE.B #imm, <ea>
    {MOVE_16_D_IMM,             0xFFFF,     0x33FC,     14}, // MOVE.W #imm, <ea>
    {MOVE_32_D_IMM,             0xFFFF,     0x23FC,     14}, // MOVE.L #imm, <ea>
    {MULS_16_D_0,               0xF1C0,     0xC1C0,     70}, // MULS.W <ea>,Dn
    {MULU_16_D_0,               0xF1C0,     0xC0C0,     70}, // MULU.W <ea>,Dn
    {NBCD_8_D_0,                0xFFFF,     0x4839,     6},  // NBCD <ea>
    {NEG_8_EA_0,                0xFFFF,     0x4439,     4},  // NEG.B <ea>
    {NEG_16_EA_0,               0xFFFF,     0x4479,     8},  // NEG.W <ea>
    {NEG_32_EA_0,               0xFFFF,     0x44B9,     12},  // NEG.L <ea>
    {NEG_8_D_0,                 0xFFF8,     0x4400,     4},  // NEG.B Dn
    {NEG_16_D_0,                0xFFF8,     0x4440,     8},  // NEG.W Dn
    {NEG_32_D_0,                0xFFF8,     0x4480,     12},  // NEG.L Dn
    {NEG_8_AN_EA,               0xFFF8,     0x4410,     4},  // NEG.B (An)
    {NEG_16_AN_EA,              0xFFF8,     0x4450,     8},  // NEG.W (An)
    {NEG_32_AN_EA,              0xFFF8,     0x4490,     12},  // NEG.L (An)
    {NEG_8_EA_POST_INC,         0xFFF8,     0x4418,     4},  // NEG.B (An)+
    {NEG_16_EA_POST_INC,        0xFFF8,     0x4458,     8},  // NEG.W (An)+
    {NEG_32_EA_POST_INC,        0xFFF8,     0x4498,     12},  // NEG.L (An)+
    {NEG_8_EA_PRE_DEC,          0xFFF8,     0x4420,     4}, // NEG.B -(An)
    {NEG_16_EA_PRE_DEC,         0xFFF8,     0x4460,     8}, // NEG.W -(An)
    {NEG_32_EA_PRE_DEC,         0xFFF8,     0x44A0,     8}, // NEG.L -(An)
    {NEGX_8_DA_0,               0xF1F8,     0x4000,     4},  // NEGX.B <ea>
    {NEGX_16_DA_0,              0xF1F8,     0x4040,     4},  // NEGX.W <ea>
    {NEGX_32_DA_0,              0xF1F8,     0x4080,     6},  // NEGX.L <ea>
    {NOT_8_D_0,                 0xFFF8,     0x4600,     4},  // NOT.B Dn
    {NOT_16_D_0,                0xFFF8,     0x4640,     4},  // NOT.W Dn
    {NOT_32_D_0,                0xFFF8,     0x4680,     6},  // NOT.L Dn
    {NOT_8_EA_0,                0xFFFF,     0x4639,     6},  // NOT.B <ea>
    {NOT_16_EA_0,               0xFFFF,     0x4679,     6},  // NOT.W <ea>
    {NOT_32_EA_0,               0xFFFF,     0x46B9,     6},  // NOT.l <ea>
    {NOP_0_0_0,                 0xFFFF,     0x4E71,     4},  // NOP
    {OR_8_D_0,                  0xF1C0,     0x8000,     4},  // OR.B <ea>,Dn
    {OR_16_D_0,                 0xF1C0,     0x8040,     4},  // OR.W <ea>,Dn
    {OR_32_D_0,                 0xF1C0,     0x8080,     6},  // OR.L <ea>,Dn
    {OR_8_DN_DY,                0xF1F8,     0x8000,     6},  // OR.B Dn,Dy
    {OR_16_DN_DY,               0xF1F8,     0x8040,     6},  // OR.W Dn,Dy
    {OR_32_DN_DY,               0xF1F8,     0x8080,     8},  // OR.l Dn,Dy
    {ORI_8_D_0,                 0xF1F8,     0x0000,     8},  // ORI.B #<data>,<ea>
    {ORI_16_D_0,                0xF1F8,     0x0040,     8},  // ORI.W #<data>,<ea>
    {ORI_32_D_0,                0xF1F8,     0x0080,     16}, // ORI.L #<data>,<ea>
    {ORI_8_IMM_EA,              0xFFFF,     0x0039,     24}, // ORI.B #imm,<ea>
    {ORI_16_IMM_EA,             0xFFFF,     0x0079,     28}, // ORI.W #imm,<ea>
    {ORI_32_IMM_EA,             0xFFFF,     0x00B9,     34}, // ORI.L #imm,<ea>
    {ORI_CCR_8_0_0,             0xFFFF,     0x003C,     20}, // ORI #<data>,CCR
    {ORI_SR_16_0_0,             0xFFFF,     0x007C,     20}, // ORI #<data>,SR
    {PEA_32_D_0,                0xFFFF,     0x4879,     12}, // PEA <ea>
    {RESET_0_0_0,               0xFFFF,     0x4E70,     132},// RESET
    {ROL_8_S_0,                 0xF1F8,     0xE118,     6},  // ROL.B #ea,Dn
    {ROL_16_S_0,                0xF1F8,     0xE158,     6},  // ROL.W #ea,Dn
    {ROL_32_S_0,                0xF1F8,     0xE198,     8},  // ROL.L #ea,Dn
    {ROL_8_R_0,                 0xFFF8,     0xE138,     6},  // ROL.B Dn, Dy
    {ROL_16_R_0,                0xFFF8,     0xE178,     6},  // ROL.W Dn, Dy
    {ROL_32_R_0,                0xFFF8,     0xE1B8,     8},  // ROL.L Dn, Dy
    {ROXL_8_S_0,                0xF1F8,     0xE130,     6},  // ROXL.B Dn,Dy
    {ROXL_16_S_0,               0xF1F8,     0xE170,     6},  // ROXL.W Dn,Dy
    {ROXL_32_S_0,               0xF1F8,     0xE1B0,     8},  // ROXL.L Dn,Dy
    {RTS_0_0_0,                 0xFFFF,     0x4E75,     16}, // RTS
    {RTE_32_0_0,                0xFFFF,     0x4E73,     20}, // RTE
    {RTR_32_0_0,                0xFFFF,     0x4E77,     20}, // RTR
    {SBCD_8_RR_0,               0xF1F8,     0x8100,     6},  // SBCD Dy,Dx
    {STOP_0_0_0,                0xFFFF,     0x4E72,     4},  // STOP #<data>
    {SUB_8_D_0,                 0xF1F8,     0x9000,     6},  // SUB.B Dn,Dy
    {SUB_16_D_0,                0xF1F8,     0x9040,     6},  // SUB.W Dn,Dy
    {SUB_32_D_0,                0xF1F8,     0x9080,     12},  // SUB.L Dn,Dy
    {SUB_8_D_EA,                0xF1FF,     0x9039,     14},  // SUB.B <ea> Dy
    {SUB_16_D_EA,               0xF1FF,     0x9079,     16},  // SUB.W <ea> Dy
    {SUB_32_D_EA,               0xF1FF,     0x90B9,     20},  // SUB.l <ea> Dy
    {SUBA_16_DA_0,              0xF1C0,     0x90C0,     8},  // SUBA.W <ea>,An
    {SUBA_32_DA_0,              0xF1C0,     0x91C0,     8},  // SUBA.L <ea>,An
    {SUBI_8_D_0,                0xFFC0,     0x0400,     8},  // SUBI.B #<data>,Dy
    {SUBI_16_D_0,               0xFFC0,     0x0440,     8},  // SUBI.W #<data>,Dy
    {SUBI_32_D_0,               0xFFC0,     0x0480,     16}, // SUBI.L #<data>,Dy
    {SUBI_8_IMM_EA,             0xFFFF,     0x0439,     10},  // SUBI.B #imm,<ea>
    {SUBI_16_IMM_EA,            0xFFFF,     0x0479,     14},  // SUBI.W #imm,<ea>
    {SUBI_32_IMM_EA,            0xFFFF,     0x04B9,     20},  // SUBI.L #imm,<ea>
    {SUBQ_8_D_0,                0xF1C0,     0x5100,     4},  // SUBQ.B #<data>,<ea>
    {SUBQ_16_D_0,               0xF1C0,     0x5140,     4},  // SUBQ.W #<data>,<ea>
    {SUBQ_32_D_0,               0xF1C0,     0x5180,     8},  // SUBQ.L #<data>,<ea>
    {SUBX_8_RR_0,               0xF1F8,     0x9100,     4},  // SUBX.B Dy,Dx
    {SUBX_16_RR_0,              0xF1F8,     0x9140,     4},  // SUBX.W Dy,Dx
    {SUBX_32_RR_0,              0xF1F8,     0x9180,     8},  // SUBX.L Dy,Dx
    {SWAP_16_D_0,               0xFFF8,     0x4840,     4},  // SWAP Dn
    {TRAP_0_0_0,                0xFFFF,     0x4E4F,     4},  // TRAP #<ea>
    {TAS_8_D_0,                 0xFFC0,     0x4AC0,     4},  // TAS <ea>
    {TST_8_D_0,                 0xFFF0,     0x4A00,     4},  // TST.B Dn
    {TST_16_D_0,                0xFFF0,     0x4A40,     4},  // TST.W Dn
    {TST_32_D_0,                0xFFF0,     0x4A80,     4},  // TST.L Dn
    {TST_8_IMM_0,               0xFFF0,     0x4A30,     4},  // TST.B <ea>
    {TST_16_IMM_0,              0xFFF0,     0x4A70,     4},  // TST.W <ea>
    {TST_32_IMM_0,              0xFFF0,     0x4AB0,     4},  // TST.L <ea>
    {UNLK_32_0_0,               0xFFF8,     0x4E58,     12}, // UNLK An
    {NULL,                      0,          0,          0}   // NULL TERM
};

/* BUILD THE OVERARCHING OPCODE TABLE BASED ON ALL OF THE DIRECTIVES AND PRE-REQUISITIES */
/* THIS WILL WORK ON THE BASIS BY WHICH IT WILL BE ASSUME THE CURRENT OPERAND BASED ON THE MASK */
/* AND IT'S DESIGNATED VALUE */ 

void M68K_BUILD_OPCODE_TABLE(void)
{
    int INDEX;
    const OPCODE_HANDLER* OSTRUCT;

    for (INDEX = 0; INDEX < 0x10000; INDEX++)
    {
        M68K_OPCODE_JUMP_TABLE[INDEX] = ILLEGAL_0_0_0;
        CYCLE_RANGE[INDEX] = 0;
    }

    OSTRUCT = M68K_OPCODE_HANDLER_TABLE;
    while (OSTRUCT->HANDLER != NULL)
    {
        #if USE_OPCODE_DEBUG == M68K_OPT_OFF

        printf("PROCESSING OPCODE: MASK = 0x%04X, MATCH = 0x%04X, HANDLER = 0x%p\n",
               OSTRUCT->MASK, OSTRUCT->MATCH, (void*)&OSTRUCT->HANDLER);

        #endif

        for (INDEX = 0; INDEX < 0x10000; INDEX++)
        {
            // IF THE CORRESPONDING OPCODE MASK FROM THE TABLE 
            // MATCHES HOW IT APPEARS IN TRAD 68K, USE THE CORRESPONDING AMOUNT OF CYCLES

            // USES THE CYCLES FROM THE OPCODE HANDLER AS A DETERMINENT
            // THIS IS BECAUSE THAT THE CLOCK CYCLES OF THE CPU *ITSELF* ARE ADJACENT
            // IN THAT REGARD TO THE OPCODE CYCLES AND HOW MUCH IS USED DURING EXECUTION

            // IT IS ALSO WORTH MENTIONING THAT CERTAIN OPCODES WILL EITHER USE 4 OR 8
            // CYCLES WHEN ACCESSING DATA

            // THE VARIANCE IN THE AMOUNT OF CYCLES IS DEPENDANT ON WHICHEVER OPCODES ARE
            // USING MEMORY OR NOT

            // AREAS SUCH AS AN IMMEDIATE SECTION DESIGNATED TO DEFINING CONSTANTS
            // WILL ONLY USE 4 CYCLES AS THAT ISNT NEEDING TO MANUALLY ASSERT ANY CHANGES IN MEMORY

            if ((INDEX & OSTRUCT->MASK) == OSTRUCT->MATCH)
            {
                M68K_OPCODE_JUMP_TABLE[INDEX] = OSTRUCT->HANDLER;
                CYCLE_RANGE[INDEX] = OSTRUCT->CYCLES;               
            }
        }

        OSTRUCT++;
    }
}

#endif

//=============================================================================
//                  68000 STD LIB EXTENDED FUNCTIONALITY
//      ALL OF THIS ISN'T REALLY USED WITHIN THE ACTUAL EMULATOR ITSELF
//   MOREOVER, THIS WAS HERE ORIGINALLY TO ALLOW FOR TESTING THE PROCESSING OF
//  OPCODES AND DIRECTIVES FROM A FILE - PAVING THE WAY FOR EVERYTHING ELSE
//=============================================================================

/* FIND AN OPCODE IN THE HANDLER LIST */
/* THIS IS DONE BY ASSUMING A STRING COMPARATOR BETWEEN AN ARBITRARY NAME */
/* PROVIDED THROUGH LOCAL ARGS AS WELL AS ONE THAT EXISTS IN THE OPCODE TABLE */
/* EVALUATE A SIZE AND RETURN THE CORRESPONDENCE */

#if USE_STD_LIB

OPCODE* FIND_OPCODE(char* NAME, int SIZE)
{
    unsigned INDEX = 0;

    for (INDEX = 0; INDEX < 1000; INDEX++)
    {
        return strcmp(NAME, &OPCODE_NAME) == 0 && (OPCODE_SIZE += (int)SIZE) ? &OPCODE_BASE : 0;
    }

   return NULL; 
}

/* NOW BASED OFF OF THE ABOVE, PARSE A RELEVANT OPCODE HANDLER NAME */
/* BASED ON THE SRC OPERAND, LOCATION, SIZE, ETC */

/* THIS WILL EXCLUDE WHITESPACE AS WELL, BEING ABLE TO READ CONTENTS EFFECTIVELY */
/* IMPLEMENTS A FIFO CHECKER TO STORE THE LOCATION AS A POINTER */

int EXTRACT_OPCODE(char* SRC, char* NAME, int* SIZE)
{
    /* DEFINE THE BUFFER THAT CURRENTLY HOUSES THE POINTER OF THE OPERAND */
    /* EVALUATE THE LENGTH */

    char* OPCODE_BUFFER = strstr(SRC, "");
    char* TYPE = NULL;
    SIZE += 32;

    OPCODE_BUFFER += strlen("") + 1;

    switch(*TYPE)
    {
        case ',':
            OPCODE_BUFFER += CHECK_OPCODE_LENGTH(NAME, OPCODE_BUFFER, *SIZE);
        return 0;

        case ')':
            OPCODE_BUFFER += CHECK_OPCODE_LENGTH(&OPCODE_EA, OPCODE_BUFFER, ')') | *SIZE;
        return 0;
    }

    return 0;
}

int CHECK_OPCODE_LENGTH(char* SRC, char* DEST, int MAX)
{
    int* LENGTH = 0;

    for(*LENGTH = 0; *SRC != 0; SRC++)
    {
        *DEST = *SRC;
    }

    *DEST = '\0';
    return DEST - (DEST - MAX);
}

#endif
#endif
